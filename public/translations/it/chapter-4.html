<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.7" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="ch04_keys_addresses_wallets">Chiavi, Indirizzi Wallet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduzione">Introduzione</h3>
<div class="paragraph"><p>La proprietà dei bitcoin si stabilisce attraverso <em>chiavi digitali</em>, <em>indirizzi bitcoin</em>, e <em>firme digitali</em>. Le chiavi digitali non sono in realtà memorizzate nella rete, ma sono invece create e memorizzate dagli utenti in un file, o in un semplice database, chiamato <em>wallet</em> (portafoglio). Le chiavi digitali nel wallet di un utente sono completamente indipendenti dal protocollo bitcoin e possono essere generate e gestite dal software del wallet dell&#8217;utente software senza relazione con la blockchain o accesso a Internet. Le Chiavi consentono molte delle interessanti proprietà dei bitcoin, inclusa controllo e la fiducia (trust) de-centralizzata, attestazione della proprietà, e il modello di sicurezza a prova crittografica.</p></div>
<div class="paragraph"><p>Ogni transazione bitcoin richiede una firma valida per essere inclusa nella blockchain, che può essere generata solo con chiavi digitali valide; pertanto, chiunque ha una copia di quelle chiavi ha il controllo del bitcoin in quel conto. Si tratta di coppie di chiavi composte da una chiave privata (segreta) e una chiave pubblica. Pensate alla chiave pubblica come ad un numero di conto bancario e la chiave privata come il PIN segreto, o la firma su un assegno che consente di controllare il conto. Queste chiavi digitali molto raramente vengono viste dagli utenti bitcoin. Per lo più, sono memorizzate all&#8217;interno del file del wallet e gestite dal software del wallet bitcoin.</p></div>
<div class="paragraph"><p>Nella parte di pagamento di una transazione bitcoin, la chiave pubblica del destinatario è rappresentata dalla sua impronta digitale, chiamata  <em>indirizzo bitcoin</em>, che viene utilizzata allo stesso modo del nome del beneficiario su un assegno (cioè, "Pagare all&#8217;ordine di"). Nella maggior parte dei casi, un indirizzo bitcoin è generato da e corrisponde ad una chiave pubblica. Tuttavia, non tutti gli indirizzi bitcoin rappresentano chiavi pubbliche; possono anche rappresentare altri beneficiari come gli script, come vedremo più avanti in questo capitolo. In questo modo, gli indirizzi bitcoin astraggono il destinatario dei fondi, rendendo flessibile le destinazioni delle transazione, simile ad assegni di carta: un unico strumento di pagamento che può essere utilizzato per pagare nei conti delle persone, pagare nei conti delle società, pagare le bollette, o pagare in contanti. L&#8217;indirizzo Bitcoin è l&#8217;unica rappresentazione delle chiavi che gli utenti regolarmente vedono, perché questa è la parte di cui hanno bisogno di condividere con il mondo.</p></div>
<div class="paragraph"><p>In questo capitolo introdurremo i wallet (portafogli), che contengono chiavi crittografiche. Vedremo come le chiavi vengono generate, archiviate, e gestite. Esamineremo i vari formati di codifica utilizzati per rappresentare le chiavi pubbliche e private, gli indirizzi e gli indirizzi script (script address). Infine, prenderemo in considerazione usi speciali di chiavi: per firmare i messaggi, per dimostrare la proprietà, e per creare vanity address e paper wallet (wallet su carta).</p></div>
<div class="sect3">
<h4 id="_la_crittografia_a_chiave_pubblica_e_le_criptovalute">La Crittografia a Chiave Pubblica e le Criptovalute</h4>
<div class="paragraph"><p>La crittografia a chiave pubblica è stata inventata negli anni '70 (1970) ed è una delle basi matematiche dei computer e della sicurezza informatica.</p></div>
<div class="paragraph"><p>Da quando  stata inventata la crittografia a chiave pubblica, sono state scoperte diverse funzioni matematiche idonee, come ad esempio  l&#8217;elevazione a potenza dei numeri primi e la moltiplicazione a curva ellittica. Queste funzioni matematiche sono praticamente irreversibili, nel senso che sono facili da calcolare in una direzione e impossibili da calcolare nella direzione opposta. Sulla base di queste funzioni matematiche, la crittografia consente la creazione di segreti digitali e firme digitali non falsificabili. Bitcoin usa la moltiplicazione a curva ellittica come base per la sua crittografia a chiave pubblica.</p></div>
<div class="paragraph"><p>In bitcoin, usiamo la crittografia a chiave pubblica per creare una coppia di chiavi che controlla l&#8217;accesso ai bitcoin. La coppia di chiavi consiste di una chiave privata e&#8212;derivata da essa&#8212;un&#8217;unica chiave pubblica. La chiave pubblica è usata per ricevere bitcoin, e la chiave privata è usata per autorizzare transazioni per spenderli.</p></div>
<div class="paragraph"><p>C'è una relazione matematica tra la chiave pubblica e quella privata che permette alla chiave privata di essere usata per generare firme sui messaggi. Questa firma può essere validata attraverso la chiave pubblica senza rivelare la chiave privata.</p></div>
<div class="paragraph"><p>Quando si spendono bitcoin, il proprietario attuale dei bitcoin presenta la sua chiave pubblica e una firma (differente ogni volta, ma creata dalla stessa chiave privata) in una transazione per autorizzare il rilascio di quei bitcoin.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Nella maggior parte delle implementazioni di wallet, le chiavi privata e pubblica sono salvate insieme come <em>coppia di chiavi</em> per convenienza. Comunque, la chiave pubblica può essere ricavata dalla chiave privata, quindi è possibile salvare anche solo la chiave privata.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="private_public_keys">Chiavi, Privata e Pubblica</h4>
<div class="paragraph"><p>A bitcoin wallet contains a collection of key pairs, each consisting of a private key and a public key. The private key (k) is a number, usually picked at random. From the private key, we use elliptic curve multiplication, a one-way cryptographic function, to generate a public key (K). From the public key (K), we use a one-way cryptographic hash function to generate a bitcoin address (A). In this section, we will start with generating the private key, look at the elliptic curve math that is used to turn that into a public key, and finally, generate a bitcoin address from the public key. The relationship between private key, public key, and bitcoin address is shown in <a href="#k_to_K_to_A">[k_to_K_to_A]</a>.</p></div>
<div class="imageblock" id="k_to_K_to_A">
<div class="content">
<img src="images/msbt_0401.png" alt="privk_to_pubK_to_addressA" />
</div>
<div class="title">Figure 1. Chiave privata, chiave pubblica e indirizzo bitcoin</div>
</div>
</div>
<div class="sect3">
<h4 id="private_keys">Chiavi Private</h4>
<div class="paragraph"><p>A private key is simply a number, picked at random. Ownership and control over the private key is the root of user control over all funds associated with the corresponding bitcoin address. The private key is used to create signatures that are required to spend bitcoins by proving ownership of funds used in a transaction. The private key must remain secret at all times, because revealing it to third parties is equivalent to giving them control over the bitcoins secured by that key. The private key must also be backed up and protected from accidental loss, because if it&#8217;s lost it cannot be recovered and the funds secured by it are forever lost, too.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>La chiave privata bitcoin è soltanto un numero. Puoi generare le tue chiavi private in modo casuale utilizzando semplicemente una moneta, una matita e un foglio di carta: lancia una moneta 256 volte e otterrai le cifre binarie di una chiave privata casuale che puoi utilizzare in un wallet bitcoin. La chiave pubblica può essere successivamente generata da quella privata.</p></div>
</td>
</tr></table>
</div>
<div class="sect4">
<h5 id="_generando_una_chiave_privata_da_un_numero_casuale">Generando una chiave privata da un numero casuale</h5>
<div class="paragraph"><p>Il primo e il più importante passo per generare chiavi per trovare una fonte sicura di entropia, o casualità. Creare una chiave bitcoin é essenzialmente la stessa cosa di "Scegli un numero tra 1 e 2<sup>256</sup>." Il metodo esatto usato per scegliere quel numero non é importante fintanto che non è prevedibile o ripetibile. Il software bitcoin usa il generatore di numeri casuali del sistema operativo per produrre 256 bit di entropia (casualità). Di solito, il generatore di numeri casuali dell&#8217;OS è inizializzato da una fonte umana di casualità, che è il motivo per il quale qualche programma potrebbe chiederti di muovere il mouse a caso per qualche secondo. Per i veri paranoici, niente batte i dadi, una matita e un pezzo di carta.</p></div>
<div class="paragraph"><p>Più accuratamente, la chiave privata potrebbe essere un qualsiasi numero da <tt>1</tt> e <tt>n - 1</tt>, dove n è una costante (n = 1.158 * 10<sup>77</sup>, un po meno di 2<sup>256</sup>) definita come l&#8217;ordine della curva ellittica usata in bitcoin (vedi <a href="#elliptic_curve">[elliptic_curve]</a>). Per creare una chiave del genere, sceglieremo casualmente un numero da 256-bit e controlleremo che  sia inferiore di <tt>n - 1</tt>. Nei termini da programmatori, questo viene realizzato tramite il dare in pasto una stringa più lunga di bit casuali, all&#8217;algoritmo di hash SHA256 che produrrà convenientemente un numero da 256-bit. Se il risultato è meno di <tt>n - 1</tt>, avremo una chiave privata adeguata. Altrimenti, riproveremo nuovamente con un altro numero casuale.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Do not write your own code to create a random number or use a "simple" random number generator offered by your programming language. Use a cryptographically secure pseudo-random number generator (CSPRNG) with a seed from a source of sufficient entropy. Study the documentation of the random number generator library you choose to make sure it is cryptographically secure. Correct implementation of the CSPRNG is critical to the security of the keys.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>La seguente è una chiave privata randomicamente (k) mostrata nella sua rappresentazione esadecimale (256 cifre mostrate come 64 cifre esadecimali, ognuna da 4 bit):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>La dimensione dello spazio di una chiave privata bitcoion, 2<sup>256</sup> è un numero incomprensibilmente grande. E' approssimativamente 10<sup>77</sup> in cifre decimali. E' stato stimato che l&#8217;universo visibile contenga 10<sup>80</sup> atomi.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>To generate a new key with the Bitcoin Core client (see <a href="#ch03_bitcoin_client">[ch03_bitcoin_client]</a>), use the <tt>getnewaddress</tt> command. For security reasons it displays the public key only, not the private key. To ask bitcoind to expose the private key, use the <tt>dumpprivkey</tt> command. The <tt>dumpprivkey</tt> command shows the private key in a Base58 checksum-encoded format called the <em>Wallet Import Format</em> (WIF), which we will examine in more detail in <a href="#priv_formats">[priv_formats]</a>. Here&#8217;s an example of generating and displaying a private key using these two commands:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ bitcoind getnewaddress
1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
$ bitcoind dumpprivkey 1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</tt></pre>
</div></div>
<div class="paragraph"><p>Il comando <tt>dumpprivkey</tt> apre il wallet e estrae la chiave privata che è stata generata dal comando <tt>getnewaddress</tt>. Non è invece possibile per bitcoind conoscere la chiave privata avendo solo la chiave pubblica, a meno che non siano entrambe salvate nel wallet.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Il comando <tt>dumpprivkey</tt> non genera una chiave privata da una chiave pubblica, visto che è impossibile. Il comando semplicemente rivela la chiave privata che è già conosciuta al wallet e che è stata generata dal comando getnewaddress.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>You can also use the Bitcoin Explorer command-line tool (see <a href="#libbitcoin">[libbitcoin]</a>) to generate and display private keys with the commands <tt>seed</tt>, <tt>ec-new</tt> and <tt>ec-to-wif</tt>: </p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ bx seed | bx ec-new | bx ec-to-wif
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</tt></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="pubkey">Chiavi Pubbliche</h4>
<div class="paragraph"><p>The public key is calculated from the private key using elliptic curve multiplication, which is irreversible: \(K = k * G\) where <em>k</em> is the private key, <em>G</em> is a constant point called the <em>generator point</em> and <em>K</em> is the resulting public key. The reverse operation, known as "finding the discrete logarithm"—calculating <em>k</em> if you know <em>K</em>—is as difficult as trying all possible values of <tt>k</tt>, i.e., a brute-force search. Before we demonstrate how to generate a public key from a private key, let&#8217;s look at elliptic curve cryptography in a bit more detail.</p></div>
</div>
<div class="sect3">
<h4 id="elliptic_curve">Crittografia a Curve Ellittiche</h4>
<div class="paragraph"><p>Elliptic curve cryptography is a type of asymmetric or public-key cryptography based on the discrete logarithm problem as expressed by addition and multiplication on the points of an elliptic curve.</p></div>
<div class="paragraph"><p><a href="#ecc-curve">[ecc-curve]</a> è un esempio di curva ellittica, simile a quella usata da bitcoin.</p></div>
<div class="imageblock" id="ecc-curve">
<div class="content">
<img src="images/msbt_0402.png" alt="ecc-curve" />
</div>
<div class="title">Figure 2. Una curva ellittica</div>
</div>
<div class="paragraph"><p>Bitcoin uses a specific elliptic curve and set of mathematical constants, as defined in a standard called <tt>secp256k1</tt>, established by the National Institute of Standards and Technology (NIST). The <tt>secp256k1</tt> curve is defined by the following function, which produces an elliptic curve:</p></div>
<div class="mathblock">
<div class="content">\begin{equation}
{y^2 = (x^3 + 7)}~\text{over}~(\mathbb{F}_p)
\end{equation}</div></div>
<div class="paragraph"><p>o</p></div>
<div class="mathblock">
<div class="content">\begin{equation}
{y^2 \mod p = (x^3 + 7) \mod p}
\end{equation}</div></div>
<div class="paragraph"><p>Il <em>mod p</em> (modulo del numero primo p) indica che questa curva è su un campo finito di numeri primi di ordine <em>p</em>, che possiamo scrivere come \(\mathbb{F}_p\), dove  p = 2<sup>256</sup> – 2<sup>32</sup> – 2<sup>9</sup> – 2<sup>8</sup> – 2<sup>7</sup> – 2<sup>6</sup> – 2<sup>4</sup> – 1, un numero primo molto grande.</p></div>
<div class="paragraph"><p>Because this curve is defined over a finite field of prime order instead of over the real numbers, it looks like a pattern of dots scattered in two dimensions, which makes it difficult to visualize. However, the math is identical as that of an elliptic curve over the real numbers. As an example, <a href="#ecc-over-F17-math">[ecc-over-F17-math]</a> shows the same elliptic curve over a much smaller finite field of prime order 17, showing a pattern of dots on a grid. The <tt>secp256k1</tt> bitcoin elliptic curve can be thought of as a much more complex pattern of dots on a unfathomably large grid.</p></div>
<div class="imageblock" id="ecc-over-F17-math">
<div class="content">
<img src="images/msbt_0403.png" alt="ecc-over-F17-math" />
</div>
<div class="title">Figure 3. Crittografia a curve ellittiche: visualizzando una curva ellittica su F(p), con p=17</div>
</div>
<div class="paragraph"><p>Quindi, per esempio, il seguente è un punto P con coordinate (x,y) che è un punto sulla curva <tt>secp256k1</tt>. Puoi controllarlo tu stesso usando Python:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>P = (55066263022277343669578718895168534326250603453777594175500187360389116729240, 32670510020758816978083085130507043184471273380659243275938904335757337482424)</tt></pre>
</div></div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="paragraph"><p>In elliptic curve math, there is a point called the "point at infinity," which roughly corresponds to the role of 0 in addition. On computers, it&#8217;s sometimes represented by x = y = 0 (which doesn&#8217;t satisfy the elliptic curve equation, but it&#8217;s an easy separate case that can be checked).</p></div>
<div class="paragraph"><p>There is also a + operator, called "addition," which has some properties similar to the traditional addition of real numbers that grade school children learn. Given two points P<sub>1</sub> and P<sub>2</sub> on the elliptic curve, there is a third point P<sub>3</sub> = P<sub>1</sub> + P<sub>2</sub>, also on the elliptic curve.</p></div>
<div class="paragraph"><p>Geometrically, this third point P<sub>3</sub> is calculated by drawing a line between P<sub>1</sub> and P<sub>2</sub>. This line will intersect the elliptic curve in exactly one additional place. Call this point P<sub>3</sub>' = (x, y). Then reflect in the x-axis to get P<sub>3</sub> = (x, –y).</p></div>
<div class="paragraph"><p>Ci sono un paio di casi particolari che chiariscono il bisogno di "puntare all&#8217;infinito".</p></div>
<div class="paragraph"><p>If P<sub>1</sub> and P<sub>2</sub> are the same point, the line "between" P<sub>1</sub> and P<sub>2</sub> should extend to be the tangent on the curve at this point P<sub>1</sub>. This tangent will intersect the curve in exactly one new point. You can use techniques from calculus to determine the slope of the tangent line. These techniques curiously work, even though we are restricting our interest to points on the curve with two integer coordinates!</p></div>
<div class="paragraph"><p>In some cases (i.e., if P<sub>1</sub> and P<sub>2</sub> have the same x values but different y values), the tangent line will be exactly vertical, in which case P3 = "point at infinity."</p></div>
<div class="paragraph"><p>If P<sub>1</sub> is the "point at infinity," then the sum P<sub>1</sub> + P<sub>2</sub> = P<sub>2</sub>. Similary, if P<sub>2</sub> is the point at infinity, then P<sub>1</sub> + P<sub>2</sub> = P<sub>1</sub>. This shows how the point at infinity plays the role of 0.</p></div>
<div class="paragraph"><p>It turns out that + is associative, which means that (A + B) + C = A + (B + C). That means we can write A + B + C without parentheses without any ambiguity.</p></div>
<div class="paragraph"><p>Now that we have defined addition, we can define multiplication in the standard way that extends addition. For a point P on the elliptic curve, if k is a whole number, then kP = P + P + P + &#8230; + P (k times). Note that k is sometimes confusingly called an "exponent" in this case.</p></div>
</div>
<div class="sect3">
<h4 id="public_key_derivation">Generare una Chiave Pubblica</h4>
<div class="paragraph"><p>Starting with a private key in the form of a randomly generated number <em>k</em>, we multiply it by a predetermined point on the curve called the <em>generator point</em> <em>G</em> to produce another point somewhere else on the curve, which is the corresponding public key <em>K</em>. The generator point is specified as part of the <tt>secp256k1</tt> standard and is always the same for all keys in bitcoin:</p></div>
<div class="mathblock">
<div class="content">\begin{equation}
{K = k * G}
\end{equation}</div></div>
<div class="paragraph"><p>where k is the private key, G is the generator point, and K is the resulting public key, a point on the curve. Because the generator point is always the same for all bitcoin users, a private key k multiplied with G will always result in the same public key K. The relationship between k and K is fixed, but can only be calculated in one direction, from k to K. That&#8217;s why a bitcoin address (derived from K) can be shared with anyone and does not reveal the user&#8217;s private key (k).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Una chiave privata può essere convertita in una chiave pubblica, ma una chiave pubblica non può essere ri-convertita in una chiave privata perchè la funzione matematica utilizzata è unidirezionale.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Implementando la moltiplicazione complessa (teoria delle curve ellittiche), prendiamo la chiave privata k generata precedentemente e la moltiplichiamo con il punto generatore G per trovare la chiave pubblica K:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>K = 1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD * G</tt></pre>
</div></div>
<div class="paragraph"><p>La Chiave Pubblica K è definita come punto <tt>K = (x,y)</tt>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>K = (x, y)

dove,

x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</tt></pre>
</div></div>
<div class="paragraph"><p>To visualize multiplication of a point with an integer, we will use the simpler elliptic curve over the real numbers—remember, the math is the same. Our goal is to find the multiple kG of the generator point G. That is the same as adding G to itself, k times in a row. In elliptic curves, adding a point to itself is the equivalent of drawing a tangent line on the point and finding where it intersects the curve again, then reflecting that point on the x-axis.</p></div>
<div class="paragraph"><p><a href="#ecc_illustrated">[ecc_illustrated]</a> mostra il processo di derivazione di  G, 2G, 4G, come un&#8217;operazione geometrica sulla curva.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Most bitcoin implementations use the <a href="http://bit.ly/1ql7bn8">OpenSSL cryptographic library</a> to do the elliptic curve math. For example, to derive the public key, the function <tt>EC_POINT_mul()</tt> is used.</p></div>
</td>
</tr></table>
</div>
<div class="imageblock" id="ecc_illustrated">
<div class="content">
<img src="images/msbt_0404.png" alt="ecc_illustrated" />
</div>
<div class="title">Figure 4. Crittografia Ellittica: Visualizzando la moltiplicazione di un punto G per un intero k su una curva ellittica</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_indirizzi_bitcoin">Indirizzi Bitcoin</h3>
<div class="paragraph"><p>A bitcoin address is a string of digits and characters that can be shared with anyone who wants to send you money. Addresses produced from public keys consist of a string of numbers and letters, beginning with the digit "1". Here&#8217;s an example of a bitcoin address:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</tt></pre>
</div></div>
<div class="paragraph"><p>The bitcoin address is what appears most commonly in a transaction as the "recipient" of the funds. If we were to compare a bitcoin transaction to a paper check, the bitcoin address is the beneficiary, which is what we write on the line after "Pay to the order of." On a paper check, that beneficiary can sometimes be the name of a bank account holder, but can also include corporations, institutions, or even cash. Because paper checks do not need to specify an account, but rather use an abstract name as the recipient of funds, that makes paper checks very flexible as payment instruments. Bitcoin transactions use a similar abstraction, the bitcoin address, to make them very flexible. A bitcoin address can represent the owner of a private/public key pair, or it can represent something else, such as a payment script, as we will see in <a href="#p2sh">[p2sh]</a>. For now, let&#8217;s examine the simple case, a bitcoin address that represents, and is derived from, a public key.</p></div>
<div class="paragraph"><p>The bitcoin address is derived from the public key through the use of one-way cryptographic hashing. A "hashing algorithm" or simply "hash algorithm" is a one-way function that produces a fingerprint or "hash" of an arbitrary-sized input. Cryptographic hash functions are used extensively in bitcoin: in bitcoin addresses, in script addresses, and in the mining proof-of-work algorithm. The algorithms used to make a bitcoin address from a public key are the Secure Hash Algorithm (SHA) and the RACE Integrity Primitives Evaluation Message Digest (RIPEMD), specifically SHA256 and RIPEMD160.</p></div>
<div class="paragraph"><p>Iniziando con la chiave pubblica K, calcoliamo l&#8217;hash SHA256 e poi calcoliamo l&#8217;hash RIPEMD160 del risultato, producendo un numero a 160-bit (20-byte):</p></div>
<div class="mathblock">
<div class="content">\begin{equation}
{A = RIPEMD160(SHA256(K))}
\end{equation}</div></div>
<div class="paragraph"><p>where K is the public key and A is the resulting bitcoin address.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>A bitcoin address is <em>not</em> the same as a public key. Bitcoin addresses are derived from a public key using a one-way function.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Bitcoin addresses are almost always presented to users in an encoding called "Base58Check" (see <a href="#base58">[base58]</a>), which uses 58 characters (a Base58 number system) and a checksum to help human readability, avoid ambiguity, and protect against errors in address transcription and entry. Base58Check is also used in many other ways in bitcoin, whenever there is a need for a user to read and correctly transcribe a number, such as a bitcoin address, a private key, an encrypted key, or a script hash. In the next section we will examine the mechanics of Base58Check encoding and decoding, and the resulting representations. <a href="#pubkey_to_address">[pubkey_to_address]</a> illustrates the conversion of a public key into a bitcoin address.</p></div>
<div class="imageblock" id="pubkey_to_address">
<div class="content">
<img src="images/msbt_0405.png" alt="pubkey_to_address" />
</div>
<div class="title">Figure 5. Public key to bitcoin address: conversion of a public key into a bitcoin address</div>
</div>
<div class="sect3">
<h4 id="base58">Encoding Base58 e Base58Check</h4>
<div class="paragraph"><p>In order to represent long numbers in a compact way, using fewer symbols, many computer systems use mixed-alphanumeric representations with a base (or radix) higher than 10. For example, whereas the traditional decimal system uses the 10 numerals 0 through 9, the hexadecimal system uses 16, with the letters A through F as the six additional symbols. A number represented in hexadecimal format is shorter than the equivalent decimal representation. Even more compact, Base-64 representation uses 26 lower-case letters, 26 capital letters, 10 numerals, and two more characters such as "+" and "/" to transmit binary data over text-based media such as email. Base-64 is most commonly used to add binary attachments to email. Base58 is a text-based binary-encoding format developed for use in bitcoin and used in many other cryptocurrencies. It offers a balance between compact representation, readability, and error detection and prevention. Base58 is a subset of Base64, using the upper- and lowercase letters and numbers, but omitting some characters that are frequently mistaken for one another and can appear identical when displayed in certain fonts. Specifically, Base58 is Base64 without the 0 (number zero), O (capital o), l (lower L), I (capital i), and the symbols "\+" and "/". Or, more simply, it is a set of lower and capital letters and numbers without the four (0, O, l, I) just mentioned.</p></div>
<div class="exampleblock" id="base58alphabet">
<div class="title">Example 1. bitcoin&#8217;s Base58 alphabet</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre><tt>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</tt></pre>
</div></div>
</div></div>
<div class="paragraph"><p>To add extra security against typos or transcription errors, Base58Check is a Base58 encoding format, frequently used in bitcoin, which has a built-in error-checking code. The checksum is an additional four bytes added to the end of the data that is being encoded. The checksum is derived from the hash of the encoded data and can therefore be used to detect and prevent transcription and typing errors. When presented with a Base58Check code, the decoding software will calculate the checksum of the data and compare it to the checksum included in the code. If the two do not match, that indicates that an error has been introduced and the Base58Check data is invalid. For example, this prevents a mistyped bitcoin address from being accepted by the wallet software as a valid destination, an error that would otherwise result in loss of funds.</p></div>
<div class="paragraph"><p>To convert data (a number) into a Base58Check format, we first add a prefix to the data, called the "version byte," which serves to easily identify the type of data that is encoded. For example, in the case of a bitcoin address the prefix is zero (0x00 in hex), whereas the prefix used when encoding a private key is 128 (0x80 in hex). A list of common version prefixes is shown in <a href="#base58check_versions">[base58check_versions]</a>.</p></div>
<div class="paragraph"><p>Next, we compute the "double-SHA" checksum, meaning we apply the SHA256 hash-algorithm twice on the previous result (prefix and data):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>checksum = SHA256(SHA256(prefix+data))</tt></pre>
</div></div>
<div class="paragraph"><p>From the resulting 32-byte hash (hash-of-a-hash), we take only the first four bytes. These four bytes serve as the error-checking code, or checksum. The checksum is concatenated (appended) to the end.</p></div>
<div class="paragraph"><p>The result is composed of three items: a prefix, the data, and a checksum. This result is encoded using the Base58 alphabet described previously. <a href="#base58check_encoding">[base58check_encoding]</a> illustrates the Base58Check encoding process.</p></div>
<div class="imageblock" id="base58check_encoding">
<div class="content">
<img src="images/msbt_0406.png" alt="Base58CheckEncoding" />
</div>
<div class="title">Figure 6. Base58Check encoding: a Base58, versioned, and checksummed format for unambiguously encoding bitcoin data</div>
</div>
<div class="paragraph"><p>In bitcoin, most of the data presented to the user is Base58Check-encoded to make it compact, easy to read, and easy to detect errors. The version prefix in Base58Check encoding is used to create easily distinguishable formats, which when encoded in Base58 contain specific characters at the beginning of the Base58Check-encoded payload. These characters make it easy for humans to identify the type of data that is encoded and how to use it. This is what differentiates, for example, a Base58Check-encoded bitcoin address that starts with a 1 from a Base58Check-encoded private key WIF format that starts with a 5. Some example version prefixes and the resulting Base58 characters are shown in <a href="#base58check_versions">[base58check_versions]</a>.</p></div>
<?hard-pagebreak?>
<div class="tableblock" id="base58check_versions">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. Prefisso di versione Base58Check e esempi del risultato</caption>
<col width="33%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr>
<th align="left" valign="top">Tipo</th>
<th align="left" valign="top"> Prefisso di versione (esadecimale)</th>
<th align="left" valign="top"> Prefisso del risultato Base58</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Bitcoin Address</p></td>
<td align="left" valign="top"><p class="table">0x00</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Pay-to-Script-Hash Address</p></td>
<td align="left" valign="top"><p class="table">0x05</p></td>
<td align="left" valign="top"><p class="table">3</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitcoin Testnet Address</p></td>
<td align="left" valign="top"><p class="table">0x6F</p></td>
<td align="left" valign="top"><p class="table">m or n</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Private Key WIF</p></td>
<td align="left" valign="top"><p class="table">0x80</p></td>
<td align="left" valign="top"><p class="table">5, K or L</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP38 Encrypted Private Key</p></td>
<td align="left" valign="top"><p class="table">0x0142</p></td>
<td align="left" valign="top"><p class="table">6P</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP32 Extended Public Key</p></td>
<td align="left" valign="top"><p class="table">0x0488B21E</p></td>
<td align="left" valign="top"><p class="table">xpub</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Let&#8217;s look at the complete process of creating a bitcoin address, from a private key, to a public key (a point on the elliptic curve), to a double-hashed address and finally, the Base58Check encoding. The C++ code in <a href="#addr_example">[addr_example]</a> shows the complete step-by-step process, from private key to Base58Check-encoded bitcoin address. The code example uses the libbitcoin library introduced in <a href="#alt_libraries">[alt_libraries]</a> for some helper functions.</p></div>
<div class="exampleblock" id="addr_example">
<div class="title">Example 2. Creazione di un indirizzo bitcoin Base58Check-encoded da una chiave privata</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="paragraph"><p>The code uses a predefined private key so that it produces the same bitcoin address every time it is run, as shown in <a href="#addr_example_run">[addr_example_run]</a>.</p></div>
<div class="exampleblock" id="addr_example_run">
<div class="title">Example 3. Compiling and running the addr code</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
</div>
<div class="sect3">
<h4 id="_key_formats">Key Formats</h4>
<div class="paragraph"><p>Both private and public keys can be represented in a number of different formats. These representations all encode the same number, even though they look different. These formats are primarily used to make it easy for people to read and transcribe keys without introducing errors.</p></div>
<div class="sect4">
<h5 id="priv_formats">Formati delle Chiavi Private</h5>
<div class="paragraph"><p>The private key can be represented in a number of different formats, all of which correspond to the same 256-bit number. <a href="#table_4-2">[table_4-2]</a> shows three common formats used to represent private keys.</p></div>
<div class="tableblock" id="table_4-2">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2. Rappresentazioni di chiavi private (formati di codifica)</caption>
<col width="33%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr>
<th align="left" valign="top">Tipo</th>
<th align="left" valign="top">Prefisso</th>
<th align="left" valign="top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Hex</p></td>
<td align="left" valign="top"><p class="table">Nessuno</p></td>
<td align="left" valign="top"><p class="table">64 cifre esadecimali</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">WIF</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">encoding Base58Check: Base58 con prefisso di versione di 128 e checksum a 32-bit</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">WIF-compressed</p></td>
<td align="left" valign="top"><p class="table">K or L</p></td>
<td align="left" valign="top"><p class="table">Come sopra, con l&#8217;aggiunta di un suffisso 0x01 precedente all&#8217;encoding</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><a href="#table_4-3">[table_4-3]</a> mostra la chiave provata generata nei seguenti tre formati.</p></div>
<?hard-pagebreak?>
<div class="tableblock" id="table_4-3">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 3. Esempio: Stessa chiave, formati differenti</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Formato </th>
<th align="left" valign="top"> Chiave Privata</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Hex</p></td>
<td align="left" valign="top"><p class="table">1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">WIF</p></td>
<td align="left" valign="top"><p class="table">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">WIF-compressed</p></td>
<td align="left" valign="top"><p class="table">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Tutte queste rappresentazioni sono modi diversi di mostrare lo stesso numero, la stessa chiave privata. Sembrano diverse, ma qualunque di questi formati possono essere convertiti in qualsiasi altro formato.</p></div>
<div class="paragraph"><p>Usiamo il comando <tt>wif-to-ec</tt> dal  Bitcoin Explorer (vedi <a href="#libbitcoin">[libbitcoin]</a>) per mostrare entrambe le chiavi WIF rappresentanti la stessa chiave privata:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ bx wif-to-ec 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd

$ bx wif-to-ec KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_decode_from_base58check">Decode from Base58Check</h5>
<div class="paragraph"><p>The Bitcoin Explorer commands (see <a href="#libbitcoin">[libbitcoin]</a>) make it easy to write shell scripts and command-line "pipes" that manipulate bitcoin keys, addresses, and transactions. You can use Bitcoin Explorer to decode the Base58Check format on the command line.</p></div>
<div class="paragraph"><p>We use the <tt>base58check-decode</tt> command to decode the uncompressed key:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ bx base58check-decode 5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn
wrapper
{
    checksum 4286807748
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd
    version 128
}</tt></pre>
</div></div>
<div class="paragraph"><p>The result contains the key as payload, the Wallet Import Format (WIF) version prefix 128, and a checksum.</p></div>
<div class="paragraph"><p>Notice that the "payload" of the compressed key is appended with the suffix <tt>01</tt>, signalling that the derived public key is to be compressed.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ bx base58check-decode KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ
wrapper
{
    checksum 2339607926
    payload 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01
    version 128
}</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_encode_from_hex_to_base58check">Encode from hex to Base58Check</h5>
<div class="paragraph"><p>To encode into Base58Check (the opposite of the previous command), we use the <tt>base58check-encode</tt> command from Bitcoin Explorer (see <a href="#libbitcoin">[libbitcoin]</a>) and provide the hex private key, followed by the Wallet Import Format (WIF) version prefix 128:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd --version 128
5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_encode_from_hex_compressed_key_to_base58check">Encode from hex (compressed key) to Base58Check</h5>
<div class="paragraph"><p> Per effettuare la codifica in Base58Check come chiave privata "compressa" (vedi <a href="#comp_priv">[comp_priv]</a>), accodiamo il suffisso <tt>01</tt> alla chiave esadecimale e poi la codifichiamo come abbiamo fatto prima:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ bx base58check-encode 1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd01 --version 128
KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</tt></pre>
</div></div>
<div class="paragraph"><p>The resulting WIF-compressed format starts with a "K". This denotes that the private key within has a suffix of "01" and will be used to produce compressed public keys only (see <a href="#comp_pub">[comp_pub]</a>).</p></div>
</div>
<div class="sect4">
<h5 id="_public_key_formats">Public key formats</h5>
<div class="paragraph"><p>Public keys are also presented in different ways, most importantly as either <em>compressed</em> or <em>uncompressed</em> public keys.</p></div>
<div class="paragraph"><p>As we saw previously, the public key is a point on the elliptic curve consisting of a pair of coordinates <tt>(x,y)</tt>. It is usually presented with the prefix <tt>04</tt> followed by two 256-bit numbers, one for the <em>x</em> coordinate of the point, the other for the <em>y</em> coordinate. The prefix <tt>04</tt> is used to distinguish uncompressed public keys from compressed public keys that begin with a <tt>02</tt> or a <tt>03</tt>.</p></div>
<div class="paragraph"><p>Here&#8217;s the public key generated by the private key we created earlier, shown as the coordinates <tt>x</tt> and <tt>y</tt>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A
y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</tt></pre>
</div></div>
<div class="paragraph"><p>Here&#8217;s the same public key shown as a 520-bit number (130 hex digits) with the prefix <tt>04</tt> followed by <tt>x</tt> and then <tt>y</tt> coordinates, as <tt>04 x y</tt>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>K = 04F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A&lt;?pdf-cr?&gt;07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="comp_pub">Chiavi pubbliche compresse</h5>
<div class="paragraph"><p><?dbhtml orphans="4"?>Compressed public keys were introduced to bitcoin to reduce the size of transactions and conserve disk space on nodes that store the bitcoin blockchain database. Most transactions include the public key, required to validate the owner&#8217;s credentials and spend the bitcoin. Each public key requires 520 bits (prefix \+ x \+ y), which when multiplied by several hundred transactions per block, or tens of thousands of transactions per day, adds a significant amount of data to the blockchain.</p></div>
<div class="paragraph"><p>As we saw in the section <a href="#pubkey">[pubkey]</a>, a public key is a point (x,y) on an elliptic curve. Because the curve expresses a mathematical function, a point on the curve represents a solution to the equation and, therefore, if we know the <em>x</em> coordinate we can calculate the <em>y</em> coordinate by solving the equation y<sup>2</sup> mod p = (x<sup>3</sup> + 7) mod p. That allows us to store only the <em>x</em> coordinate of the public key point, omitting the <em>y</em> coordinate and reducing the size of the key and the space required to store it by 256 bits. An almost 50% reduction in size in every transaction adds up to a lot of data saved over time!</p></div>
<div class="paragraph"><p>Whereas uncompressed public keys have a prefix of <tt>04</tt>, compressed public keys start with either a <tt>02</tt> or a <tt>03</tt> prefix. Let&#8217;s look at why there are two possible prefixes: because the left side of the equation is y<sup>2</sup>, that means the solution for y is a square root, which can have a positive or negative value. Visually, this means that the resulting <em>y</em> coordinate can be above the x-axis or below the x-axis. As you can see from the graph of the elliptic curve in <a href="#ecc-curve">[ecc-curve]</a>, the curve is symmetric, meaning it is reflected like a mirror by the x-axis. So, while we can omit the <em>y</em> coordinate we have to store the <em>sign</em> of y (positive or negative), or in other words, we have to remember if it was above or below the x-axis because each of those options represents a different point and a different public key. When calculating the elliptic curve in binary arithmetic on the finite field of prime order p, the <em>y</em> coordinate is either even or odd, which corresponds to the positive/negative sign as explained earlier. Therefore, to distinguish between the two possible values of y, we store a compressed public key with the prefix <tt>02</tt> if the <tt>y</tt> is even, and <tt>03</tt> if it is odd, allowing the software to correctly deduce the <em>y</em> coordinate from the <em>x</em> coordinate and uncompress the public key to the full coordinates of the point. Public key compression is illustrated in <a href="#pubkey_compression">[pubkey_compression]</a>.</p></div>
<div class="imageblock" id="pubkey_compression">
<div class="content">
<img src="images/msbt_0407.png" alt="pubkey_compression" />
</div>
<div class="title">Figure 7. Public key compression</div>
</div>
<div class="paragraph"><p>Here&#8217;s the same public key generated previously, shown as a compressed public key stored in 264 bits (66 hex digits) with the prefix <tt>03</tt> indicating the <em>y</em> coordinate is odd:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>K = 03F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A</tt></pre>
</div></div>
<div class="paragraph"><p>This compressed public key corresponds to the same private key, meaning that it is generated from the same private key. However, it looks different from the uncompressed public key. More importantly, if we convert this compressed public key to a bitcoin address using the double-hash function (<tt>RIPEMD160(SHA256(K))</tt>) it will produce a <em>different</em> bitcoin address. This can be confusing, because it means that a single private key can produce a public key expressed in two different formats (compressed and uncompressed) that produce two different bitcoin addresses. However, the private key is identical for both bitcoin addresses.</p></div>
<div class="paragraph"><p>Compressed public keys are gradually becoming the default across bitcoin clients, which is having a significant impact on reducing the size of transactions and therefore the blockchain. However, not all clients support compressed public keys yet. Newer clients that support compressed public keys have to account for transactions from older clients that do not support compressed public keys. This is especially important when a wallet application is importing private keys from another bitcoin wallet application, because the new wallet needs to scan the blockchain to find transactions corresponding to these imported keys. Which bitcoin addresses should the bitcoin wallet scan for? The bitcoin addresses produced by uncompressed public keys, or the bitcoin addresses produced by compressed public keys? Both are valid bitcoin addresses, and can be signed for by the private key, but they are different addresses!</p></div>
<div class="paragraph"><p>To resolve this issue, when private keys are exported from a wallet, the Wallet Import Format that is used to represent them is implemented differently in newer bitcoin wallets, to indicate that these private keys have been used to produce <em>compressed</em> public keys and therefore <em>compressed</em> bitcoin addresses. This allows the importing wallet to distinguish between private keys originating from older or newer wallets and search the blockchain for transactions with bitcoin addresses corresponding to the uncompressed, or the compressed, public keys, respectively. Let&#8217;s look at how this works in more detail, in the next section.</p></div>
</div>
<div class="sect4">
<h5 id="comp_priv">Compressed private keys</h5>
<div class="paragraph"><p>Ironically, the term "compressed private key" is misleading, because when a private key is exported as WIF-compressed it is actually one byte <em>longer</em> than an "uncompressed" private key. That is because it has the added 01 suffix, which signifies it comes from a newer wallet and should only be used to produce compressed public keys. Private keys are not compressed and cannot be compressed. The term "compressed private key" really means "private key from which compressed public keys should be derived," whereas "uncompressed private key" really means "private key from which uncompressed public keys should be derived." You should only refer to the export format as "WIF-compressed" or "WIF" and not refer to the private key as "compressed" to avoid further confusion.</p></div>
<div class="paragraph"><p>Remember, these formats are <em>not</em> used interchangeably. In a newer wallet that implements compressed public keys, the private keys will only ever be exported as WIF-compressed (with a K or L prefix). If the wallet is an older implementation and does not use compressed public keys, the private keys will only ever be exported as WIF (with a 5 prefix). The goal here is to signal to the wallet importing these private keys whether it must search the blockchain for compressed or uncompressed public keys and addresses.</p></div>
<div class="paragraph"><p>If a bitcoin wallet is able to implement compressed public keys, it will use those in all transactions. The private keys in the wallet will be used to derive the public key points on the curve, which will be compressed. The compressed public keys will be used to produce bitcoin addresses and those will be used in transactions. When exporting private keys from a new wallet that implements compressed public keys, the Wallet Import Format is modified, with the addition of a one-byte suffix <tt>01</tt> to the private key. The resulting Base58Check-encoded private key is called a "Compressed WIF" and starts with the letter K or L, instead of starting with "5" as is the case with WIF-encoded (non-compressed) keys from older wallets.</p></div>
<div class="paragraph"><p><a href="#table_4-4">[table_4-4]</a> shows the same key, encoded in WIF and WIF-compressed formats.</p></div>
<div class="tableblock" id="table_4-4">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 4. Esempio: Stessa chiave, formati differenti</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Formato </th>
<th align="left" valign="top"> Chiave Privata</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Hex</p></td>
<td align="left" valign="top"><p class="table">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">WIF</p></td>
<td align="left" valign="top"><p class="table">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Hex-compressed</p></td>
<td align="left" valign="top"><p class="table">1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD_01_</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">WIF-compressed</p></td>
<td align="left" valign="top"><p class="table">KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>"Compressed private keys" is a misnomer! They are not compressed; rather, the WIF-compressed format signifies that they should only be used to derive compressed public keys and their corresponding bitcoin addresses. Ironically, a "WIF-compressed" encoded private key is one byte longer because it has the added 01 suffix to distinguish it from an "uncompressed" one.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_keys_and_addresses_in_python">Implementing Keys and Addresses in Python</h3>
<div class="paragraph"><p>The most comprehensive bitcoin library in Python is <a href="https://github.com/vbuterin/pybitcointools">pybitcointools</a> by Vitalik Buterin. In <a href="#key-to-address_script">[key-to-address_script]</a>, we use the pybitcointools library (imported as "bitcoin") to generate and display keys and addresses in various formats.</p></div>
<div class="exampleblock" id="key-to-address_script">
<div class="title">Example 4. Key and address generation and formatting with the pybitcointools library</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="paragraph"><p><a href="#key-to-address_script_run">[key-to-address_script_run]</a> mostra l&#8217;output ottenuto eseguendo questo codice.</p></div>
<div class="exampleblock" id="key-to-address_script_run">
<div class="title">Example 5. Running key-to-address-ecc-example.py</div>
<div class="content">
<screen>
$ python key-to-address-ecc-example.py
Private Key (hex) is:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa6
Private Key (decimal) is:
 26563230048437957592232553826663696440606756685920117476832299673293013768870
Private Key (WIF) is:
 5JG9hT3beGTJuUAmCQEmNaxAuMacCTfXuw1R3FCXig23RQHMr4K
Private Key Compressed (hex) is:
 3aba4162c7251c891207b747840551a71939b0de081f85c4e44cf7c13e41daa601
Private Key (WIF-Compressed) is:
 KyBsPXxTuVD82av65KZkrGrWi5qLMah5SdNq6uftawDbgKa2wv6S
Public Key (x,y) coordinates is:
 (41637322786646325214887832269588396900663353932545912953362782457239403430124L,
 16388935128781238405526710466724741593761085120864331449066658622400339362166L)
Public Key (hex) is:
 045c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec<?pdf-cr?>243bcefdd4347074d44bd7356d6a53c495737dd96295e2a9374bf5f02ebfc176
Compressed Public Key (hex) is:
 025c0de3b9c8ab18dd04e3511243ec2952002dbfadc864b9628910169d9b9b00ec
Bitcoin Address (b58check) is:
 1thMirt546nngXqyPEz532S8fLwbozud8
Compressed Bitcoin Address (b58check) is:
 14cxpo3MBCYYWCgF74SWTdcmxipnGUsPw3
</screen>
</div></div>
<div class="paragraph"><p><a href="#ec_math">[ec_math]</a> is another example, using the Python ECDSA library for the elliptic curve math and without using any specialized bitcoin libraries.</p></div>
<div class="exampleblock" id="ec_math">
<div class="title">Example 6. A script demonstrating elliptic curve math used for bitcoin keys</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="paragraph"><p><a href="#ec_math_run">[ec_math_run]</a> shows the output produced by running this script.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>The example above uses <tt>os.urandom</tt>, which reflects a cryptographically secure random number generator (CSRNG) provided by the underlying operating system. In the case of an UNIX-like operating system such as Linux, it draws from <tt>/dev/urandom</tt>; and in the case of Windows, calls <tt>CryptGenRandom()</tt>. If a suitable randomness source is not found, <tt>NotImplementedError</tt> will be raised. While the random number generator used here is for demonstration purposes, it is <em>not</em> appropriate for generating production-quality bitcoin keys as it is not implemented with sufficient security.</p></div>
</td>
</tr></table>
</div>
<div class="exampleblock" id="ec_math_run">
<div class="title">Example 7. Installing the Python ECDSA library and running the ec_math.py script</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre><tt>$ # Install Python PIP package manager
$ sudo apt-get install python-pip
$ # Install the Python ECDSA library
$ sudo pip install ecdsa
$ # Run the script
$ python ec-math.py
Secret:  38090835015954358862481132628887443905906204995912378278060168703580660294000
EC point: (70048853531867179489857750497606966272382583471322935454624595540007269312627, 105262206478686743191060800263479589329920209527285803935736021686045542353380)
BTC public key: 029ade3effb0a67d5c8609850d797366af428f4a0d5194cb221d807770a1522873</tt></pre>
</div></div>
</div></div>
</div>
<div class="sect2">
<h3 id="_i_wallet">I Wallet</h3>
<div class="paragraph"><p>Wallets are containers for private keys, usually implemented as structured files or simple databases.
Another method for making keys is <em>deterministic key generation</em>. Here you derive each new private key, using a one-way hash function from a previous private key, linking them in a sequence. As long as you can re-create that sequence, you only need the first key (known as a <em>seed</em> or <em>master</em> key) to generate them all. In this section we will examine the different methods of key generation and the wallet structures that are built around them.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Bitcoin wallets contain keys, not coins. Each user has a wallet containing keys. Wallets are really keychains containing pairs of private/public keys (see <a href="#private_public_keys">[private_public_keys]</a>). Users sign transactions with the keys, thereby proving they own the transaction outputs (their coins). The coins are stored on the blockchain in the form of transaction-ouputs (often noted as vout or txout).</p></div>
</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="random_wallet">Nondeterministic (Random) Wallets</h4>
<div class="paragraph"><p>In the first bitcoin clients, wallets were simply collections of randomly generated private keys. This type of wallet is called a <em>Type-0 nondeterministic wallet</em>. For example, the Bitcoin Core client pregenerates 100 random private keys when first started and generates more keys as needed, using each key only once. This type of wallet is nicknamed "Just a Bunch Of Keys," or JBOK, and such wallets are being replaced with deterministic wallets because they are cumbersome to manage, back up, and import. The disadvantage of random keys is that if you generate many of them you must keep copies of all of them, meaning that the wallet must be backed up frequently. Each key must be backed up, or the funds it controls are irrevocably lost if the wallet becomes inaccessible. This conflicts directly with the principle of avoiding address re-use, by using each bitcoin address for only one transaction. Address re-use reduces privacy by associating multiple transactions and addresses with each other. A Type-0 nondeterministic wallet is a poor choice of wallet, especially if you want to avoid address re-use because that means managing many keys, which creates the need for frequent backups. Although the Bitcoin Core client includes a Type-0 wallet, using this wallet is discouraged by developers of Bitcoin Core. <a href="#Type0_wallet">[Type0_wallet]</a> shows a nondeterministic wallet, containing a loose collection of random keys.</p></div>
</div>
<div class="sect3">
<h4 id="_deterministic_seeded_wallets">Deterministic (Seeded) Wallets</h4>
<div class="paragraph"><p>Deterministic, or "seeded" wallets are wallets that contain private keys that are all derived from a common seed, through the use of a one-way hash function. The seed is a randomly generated number that is combined with other data, such as an index number or "chain code" (see <a href="#hd_wallets">[hd_wallets]</a>) to derive the private keys. In a deterministic wallet, the seed is sufficient to recover all the derived keys, and therefore a single backup at creation time is sufficient. The seed is also sufficient for a wallet export or import, allowing for easy migration of all the user&#8217;s keys between different wallet implementations.</p></div>
<div class="imageblock" id="Type0_wallet">
<div class="content">
<img src="images/msbt_0408.png" alt="non-deterministic wallet" />
</div>
<div class="title">Figure 8. Type-0 nondeterministic (random) wallet: a collection of randomly generated keys</div>
</div>
</div>
<div class="sect3">
<h4 id="mnemonic_code_words">Mnemonic Code Words</h4>
<div class="paragraph"><p>Mnemonic codes are English word sequences that represent (encode) a random number used as a seed to derive a deterministic wallet. The sequence of words is sufficient to re-create the seed and from there re-create the wallet and all the derived keys. A wallet application that implements deterministic wallets with mnemonic code will show the user a sequence of 12 to 24 words when first creating a wallet. That sequence of words is the wallet backup and can be used to recover and re-create all the keys in the same or any compatible wallet application. Mnemonic code words make it easier for users to back up wallets because they are easy to read and correctly transcribe, as compared to a random sequence of numbers.</p></div>
<div class="paragraph"><p>Mnemonic codes are defined in Bitcoin Improvement Proposal 39 (see <a href="#bip0039">[bip0039]</a>), currently in Draft status. Note that BIP0039 is a draft proposal and not a standard. Specifically, there is a different standard, with a different set of words, used by the Electrum wallet and predating BIP0039. BIP0039 is used by the Trezor wallet and a few other wallets but is incompatible with Electrum&#8217;s implementation.</p></div>
<div class="paragraph"><p>BIP0039 defines the creation of a mnemonic code and seed as a follows:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Create a random sequence (entropy) of 128 to 256 bits.
</p>
</li>
<li>
<p>
Create a checksum of the random sequence by taking the first few bits of its SHA256 hash.
</p>
</li>
<li>
<p>
Add the checksum to the end of the random sequence.
</p>
</li>
<li>
<p>
Divide the sequence into sections of 11 bits, using those to index a dictionary of 2048 predefined words.
</p>
</li>
<li>
<p>
Produce 12 to 24 words representing the mnemonic code.
</p>
</li>
</ol></div>
<div class="paragraph"><p><a href="#table_4-5">[table_4-5]</a> shows the relationship between the size of entropy data and the length of mnemonic codes in words.</p></div>
<div class="tableblock" id="table_4-5">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 5. Mnemonic codes: entropy and word length</caption>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
<thead>
<tr>
<th align="left" valign="top">Entropy (bits) </th>
<th align="left" valign="top"> Checksum (bits) </th>
<th align="left" valign="top"> Entropy+checksum </th>
<th align="left" valign="top"> Word length</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">128</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
<td align="left" valign="top"><p class="table">132</p></td>
<td align="left" valign="top"><p class="table">12</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">160</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">165</p></td>
<td align="left" valign="top"><p class="table">15</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">192</p></td>
<td align="left" valign="top"><p class="table">6</p></td>
<td align="left" valign="top"><p class="table">198</p></td>
<td align="left" valign="top"><p class="table">18</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">224</p></td>
<td align="left" valign="top"><p class="table">7</p></td>
<td align="left" valign="top"><p class="table">231</p></td>
<td align="left" valign="top"><p class="table">21</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">256</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
<td align="left" valign="top"><p class="table">264</p></td>
<td align="left" valign="top"><p class="table">24</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Il codice mnemonico rappresenta da 128 a 256 bit, che sono usati per derivare un seed più lungo (512-bit) attraverso l&#8217;uso della funzione di key-stretching PBKDF2. Il seed risultante è usato per creare un wallet deterministico e tutte le sue chiavi derivate.</p></div>
<div class="paragraph"><p>Tables <xref linkend="table_4-6" xrefstyle="select: labelnumber"/> and <xref linkend="table_4-7" xrefstyle="select: labelnumber"/> show some examples of mnemonic codes and the seeds they produce.</p></div>
<div class="tableblock" id="table_4-6">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 6. 128-bit entropy mnemonic code and resulting seed</caption>
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Entropy input (128 bits)</strong></p></td>
<td align="left" valign="top"><p class="table">0c1e24e5917779d297e14d45f14e1a1a</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Mnemonic (12 parole)</strong></p></td>
<td align="left" valign="top"><p class="table">army van defense carry jealous true garbage claim echo media make crunch</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Seed  (512 bits)</strong></p></td>
<td align="left" valign="top"><p class="table">3338a6d2ee71c7f28eb5b882159634cd46a898463e9d2d0980f8e80dfbba5b0fa0291e5fb88
8a599b44b93187be6ee3ab5fd3ead7dd646341b2cdb8d08d13bf7</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock" id="table_4-7">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 7. 256-bit entropy mnemonic code and resulting seed</caption>
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Entropy input (256 bits)</strong></p></td>
<td align="left" valign="top"><p class="table">2041546864449caff939d32d574753fe684d3c947c3346713dd8423e74abcf8c</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Mnemonic (24 words)</strong></p></td>
<td align="left" valign="top"><p class="table">cake apple borrow silk endorse fitness top denial coil riot stay wolf
luggage oxygen faint major edit measure invite love trap field dilemma oblige</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Seed (512 bits)</strong></p></td>
<td align="left" valign="top"><p class="table">3972e432e99040f75ebe13a660110c3e29d131a2c808c7ee5f1631d0a977fcf473bee22
fce540af281bf7cdeade0dd2c1c795bd02f1e4049e205a0158906c343</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hd_wallets">Wallet Gerarchici Deterministici (BIP0032/BIP0044)</h4>
<div class="paragraph"><p> I wallet Deterministici sono stati sviluppati per consentire di derivare chiavi multiple da un singolo "seme" (seed). La forma più avanzata di wallet deterministico è il <em>hierarchical deterministic wallet</em> o <em>HD wallet</em> definito dallo standard BIP0032. I wallet gerarchici deterministici contengono chiavi derivate in una struttura ad albero, tale che da una chiave madre si può far derivare una sequenza di chiavi figlie, e da ognuna di queste si può far derivare una sequenza di chiavi nipoti, e così via, ad una profondità infinita. Questa struttura ad albero è illustrata in <a href="#Type2_wallet">[Type2_wallet]</a>.</p></div>
<div class="imageblock" id="Type2_wallet">
<div class="content">
<img src="images/msbt_0409.png" alt="HD wallet" />
</div>
<div class="title">Figure 9. Type-2 wallet gerarchico deterministico: una albero di chiavi generate da un singolo seme</div>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Se si sta implementando un wallet bitcoin, dovrebbe essere costruito come HD wallet seguendo gli standard BIP0032 e BIP0044.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Gli HD wallet offrono due importanti vantaggi rispetto alle chiavi casuali (non deterministiche). In primo luogo, la struttura ad albero può essere usata per rappresentare una struttura organizzativa aggiuntiva, ad esempio un ramo specifico di sottochiavi potrebbe essere utilizzato per ricevere i pagamenti in arrivo e un altro ramo per ricevere il resto da pagamenti in uscita. Alcuni rami di chiavi potrebbero essere utilizzate in diversi rami aziendali, assegnando diversi rami a dipartimenti, società affiliate, funzioni specifiche, o categorie contabili.</p></div>
<div class="paragraph"><p>Il secondo vantaggio dei wallet HD è che gli utenti possono creare una sequenza di chiavi pubbliche senza avere accesso alle corrispondenti chiavi private. Questo permette ai wallet HD di essere utilizzati su un server non sicuro o con sola capacità di ricezione, con l&#8217;emissione di una diversa chiave pubblica per ogni transazione. Le chiavi pubbliche non devono essere precaricate o derivati in anticipo, inoltre il server non deve avere le chiavi private necessarie per spendere i fondi.</p></div>
<div class="sect4">
<h5 id="_creazione_del_wallet_hd_da_un_seme">Creazione del wallet HD da un seme</h5>
<div class="paragraph"><p> I wallet HD sono creati da un singolo <em>root seed</em>, che è un numero casuale a 128-, 256-, o 512-bit. Tutto il resto nei wallet HD è deterministicamente derivato da questo seme radice, che rende possibile ricreare l&#8217;intero wallet HD da quel seme in ogni wallet HD compatibile. Questo rende semplice effettuare copie di sicurezza, ripristinare, esportare, e importare wallet HD contenenti migliaia o anche milioni di chiavi semplicemente trasferendo solo il seme radice. Il seme radice viene spesso rappresentato da una <em>sequenza mnemonica di parole</em>, come descritto nella precedente sezione  <a href="#mnemonic_code_words">[mnemonic_code_words]</a>, per rendere più semplice alle persone trascriverle e conservarle.</p></div>
<div class="paragraph"><p>Il processo di creare le chiavi master e il codice master chainper un wallet HD è mostrato in <a href="#HDWalletFromSeed">[HDWalletFromSeed]</a>.</p></div>
<div class="imageblock" id="HDWalletFromSeed">
<div class="content">
<img src="images/msbt_0410.png" alt="HDWalletFromRootSeed" />
</div>
<div class="title">Figure 10. Creare le chiavi master e il chain code da un seme radice</div>
</div>
<div class="paragraph"><p>Il seme radice è l&#8217;input nell&#8217;algoritmo HMAC-SHA512 e l&#8217;hash risultante viene usato per creare una <em>chiave privata master</em> (m) e un <em>codice master chain</em>. La chiave privata master (m) poi genera una chiave pubblica master corrispondente (M), usando il normale processo di moltiplicazione <tt>m * G</tt> della curva ellitica che abbiamo visto precedentemente in questo capitolo. Il codice chain viene usato per introdurre entropia nela funzione che crea le chiavi figlie dalle chiavi madre, come vedremo nella prossima sezione.</p></div>
</div>
<div class="sect4">
<h5 id="_derivazione_delle_chiavi_private_figlie">Derivazione delle chiavi private figlie</h5>
<div class="paragraph"><p>Hierarchical deterministic wallets use a <em>child key derivation</em> (CKD) function to derive children keys from parent keys.</p></div>
<div class="paragraph"><p>Le funzioni di derivazione delle chiavi figlie sono basate su una funzione hash mono-direzionale che combina:</p></div>
<div class="ulist"><ul>
<li>
<p>
Una chiave madre privata o pubblica (chiave ECDSA non compressa)
</p>
</li>
<li>
<p>
Un seme chiamato chain code (256 bit)
</p>
</li>
<li>
<p>
Un numero indice (32 bit)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Il chain code viene utilizzato per introdurre dati apparentemente casuali nel processo, in modo che non sia sufficiente l&#8217;indice per derivare altre chiavi figlie. In questo modo, avere una chiave figlia non rende possibile trovare le chiavi sorelle, a meno che non si possegga anche il chain code. Il seme iniziale del chain code (alla radice dell&#8217;albero) è composto da dati casuali, mentre i successivi chain code sono derivate da ogni chain code padre.</p></div>
<div class="paragraph"><p>Questi tre elementi vengono combinati e codificati come hash per generare chiavi figlie, come di seguito.</p></div>
<div class="paragraph"><p>La chiave pubblica principale, il chain code, e il numero indice vengono combinati e codificati con l&#8217;algoritmo hash HMAC-SHA512 per produrre un hash di 512 bit. L&#8217;hash risultante viene diviso in due metà. I 256 bit della metà di destra dell' hash risultante diventa il chain code per il figlia. I 256 bit della metà di sinistra dell&#8217;hash e il numero indice vengono aggiunti alla chiave privata madre per produrre la chiave privata figlia. In &lt;&lt; CKDpriv &gt;&gt;, lo vediamo illustrato con il set di indice 0 per produrre lo 0&#8217;esimo (primo per indice) figlio del genitore.</p></div>
<div class="paragraph" id="CKDpriv"><p>Estendere una chiave privata madre per creare una chiave privata figlia
<span class="image">
<img src=":images/msbt_0411.png" alt="ChildPrivateDerivation" />
</span></p></div>
<div class="paragraph"><p>Cambiare l&#8217;indice ci consente di estendere la chiave madre e creare gli altri figli in sequenza, ad esempio Figlio 0, Figlio 1, Figlio 2, ecc. Ogni chiave madre può avere 2 miliardi di chiavi figlie.</p></div>
<div class="paragraph"><p>Ripetendo il processo di un livello verso il basso nell&#8217;albero, ogni figlia può a sua volta diventare madre e creare le proprie figlie, in un numero infinito di generazioni.</p></div>
</div>
<div class="sect4">
<h5 id="_usare_le_chiavi_figlie_derivate">Usare le chiavi figlie derivate</h5>
<div class="paragraph"><p> Le chiavi private figlie sono indistinguibili dalle chiavi non deterministiche (casuali). Poiché la funzione di derivazione è una funzione unidirezionale, la chiave figlia non può essere utilizzata per trovare la chiave madre. La chiave figlia inoltre non può essere usata per trovare eventuali sorelle. Se avete l&#8217;n°esima figlia, non è possibile trovare le sue sorelle, come la figlia n-1 o la figlia n + 1, o qualsiasi altra figlia che fa parte della sequenza. Solo la chiave madre e il codice della catena possono produrre tutte le figlie. Senza il codice della catena della figlia, la chiave figlia non può essere utilizzata neanche per ricavare eventuali nipoti. È necessaria sia la chiave privata figlia che il codice della catena figlia per iniziare un nuovo ramo e derivare nipoti.</p></div>
<div class="paragraph"><p>Quindi la chiave figlia privata di per se stessa per cosa può essere utilizzata? Può essere utilizzata per fare una chiave pubblica e un indirizzo bitcoin. Quindi, può essere utilizzata per firmare transazioni per spendere tutto ciò che è stato pagato su tale indirizzo.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Una chiave figlia privata, la corrispondente chiave pubblica, e l&#8217;indirizzo bitcoin sono tutti indistinguibili da chiavi e indirizzi creati in modo casuale. Il fatto che siano parte di una sequenza non è visibile, all&#8217;esterno della funzione HD wallet che li ha generati. Una volta create, operano esattamente come chiavi "normali".</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect4">
<h5 id="_chiavi_estese">Chiavi estese</h5>
<div class="paragraph"><p>Come abbiamo visto in precedenza, la funzione di derivazione delle chiavi può essere utilizzata per creare figlie a qualsiasi livello della struttura, sulla base dei tre ingressi: una chiave, un codice a catena, e l&#8217;indice della figlia desiderata. I due ingredienti essenziali sono il codice della chiave e della catena, e quando combinati vengono chiamati una  <em>chiave estesa</em>. Il termine "chiave estesa" potrebbe anche essere pensato come "chiave estensibile" perché tale chiave può essere usata per derivare delle chiavi figlie.</p></div>
<div class="paragraph"><p>Le chiavi estese sono memorizzate e rappresentate semplicemente come la concatenazione della chiave a 256 bit e il codice a catena a 256 bit in una sequenza di 512 bit. Esistono due tipi di chiavi estese. Una chiave privata estesa è la combinazione di una chiave privata e codice catena e può essere utilizzato perderivare chiavi figlie private (e da loro, chiavi figlie pubbliche). Una chiave pubblica estesa è una chiave pubblica e catena codice, che può essere utilizzato per creare chiavi pubbliche figlie, come descritto in <a href="#public_key_derivation">[public_key_derivation]</a>.</p></div>
<div class="paragraph"><p>Pensate a una chiave estesa come alla radice di un ramo nella struttura del portafoglio HD. Con la radice del ramo, è possibile derivare il resto del ramo. La chiave privata estesa può creare un ramo completo, mentre la chiave pubblica estesa può creare solo un ramo di chiavi pubbliche.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Una chiave estesa è composta da una chiave privata o pubblica e chain code (codice catena). Una chiave estesa può creare figli, generando un proprio ramo nella struttura ad albero. Condividere una chiave estesa dà accesso a tutto il ramo.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Chiavi estese sono codificate utilizzando Base58Check, per poter essere esportate e importate facilmente tra i diversi portafogli compatibili BIP0032. La codifica Base58Check per le chiavi estese utilizza un numero di versione speciale che produce il prefisso "xprv" e "xpub" quando codificato in caratteri a Base58, per renderli facilmente riconoscibili. Poiché la chiave estesa è 512 o 513 bit, è anche molto più lunga di altre stringhe Base58Check codificate che abbiamo visto in precedenza.</p></div>
<div class="paragraph"><p>Ecco un esempio di una chiave privata estesa, codificata in Base58Check:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>xprv9tyUQV64JT5qs3RSTJkXCWKMyUgoQp7F3hA1xzG6ZGu6u6Q9VMNjGr67Lctvy5P8oyaYAL9CAWrUE9i6GoNMKUga5biW6Hx4tws2six3b9c</tt></pre>
</div></div>
<div class="paragraph"><p>Ecco la corrispondente chiave pubblica estesa, anche questa codificata in Base58Check:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>xpub67xpozcx8pe95XVuZLHXZeG6XWXHpGq6Qv5cmNfi7cS5mtjJ2tgypeQbBs2UAR6KECeeMVKZBPLrtJunSDMstweyLXhRgPxdp14sk9tJPW9</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="public__child_key_derivation">Public child key derivation</h5>
<div class="paragraph"><p>Come menzionato  precedentemente, una caratteristica molto utile dei wallet gerarchici deterministici è l&#8217;abilità di derivare chiavi pubbliche figlie da chiavi pubbliche madri, <em>senza</em> avere le chiavi private. Questo ci fornisce due modi di derivare una chiave pubblica: sia dalla chiave privata figlia, o direttamente dalla chiave pubblica madre.</p></div>
<div class="paragraph"><p>An extended public key can be used, therefore, to derive all of the <em>public</em> keys (and only the public keys) in that branch of the HD wallet structure.</p></div>
<div class="paragraph"><p>This shortcut can be used to create very secure public-key-only deployments where a server or application has a copy of an extended public key and no private keys whatsoever. That kind of deployment can produce an infinite number of public keys and bitcoin addresses, but cannot spend any of the money sent to those addresses. Meanwhile, on another, more secure server, the extended private key can derive all the corresponding private keys to sign transactions and spend the money.</p></div>
<div class="paragraph"><p>One common application of this solution is to install an extended public key on a web server that serves an ecommerce application. The web server can use the public key derivation function to create a new bitcoin address for every transaction (e.g., for a customer shopping cart). The web server will not have any private keys that would be vulnerable to theft. Without HD wallets, the only way to do this is to generate thousands of bitcoin addresses on a separate secure server and then preload them on the ecommerce server. That approach is cumbersome and requires constant maintenance to ensure that the ecommerce server doesn&#8217;t "run out" of keys.</p></div>
<div class="paragraph"><p>Another common application of this solution is for cold-storage or hardware wallets. In that scenario, the extended private key can be stored on a paper wallet or hardware device (such as a Trezor hardware wallet), while the extended public key can be kept online. The user can create "receive" addresses at will, while the private keys are safely stored offline. To spend the funds, the user can use the extended private key on an offline signing bitcoin client or sign transactions on the hardware wallet device (e.g., Trezor). <a href="#CKDpub">[CKDpub]</a> illustrates the mechanism for extending a parent public key to derive child public keys.</p></div>
<div class="imageblock" id="CKDpub">
<div class="content">
<img src="images/msbt_0412.png" alt="ChildPublicDerivation" />
</div>
<div class="title">Figure 11. Extending a parent public key to create a child public key</div>
</div>
</div>
<div class="sect4">
<h5 id="_hardened_child_key_derivation">Hardened child key derivation</h5>
<div class="paragraph"><p>The ability to derive a branch of public keys from an extended public key is very useful, but it comes with a potential risk. Access to an extended public key does not give access to child private keys. However, because the extended public key contains the chain code, if a child private key is known, or somehow leaked, it can be used with the chain code to derive all the other child private keys. A single leaked child private key, together with a parent chain code, reveals all the private keys of all the children. Worse, the child private key together with a parent chain code can be used to deduce the parent private key.</p></div>
<div class="paragraph"><p>To counter this risk, HD wallets use an alternative derivation function called <em>hardened derivation</em>, which "breaks" the relationship between parent public key and child chain code. The hardened derivation function uses the parent private key to derive the child chain code, instead of the parent public key. This creates a "firewall" in the parent/child sequence, with a chain code that cannot be used to compromise a parent or sibling private key. The hardened derivation function looks almost identical to the normal child private key derivation, except that the parent private key is used as input to the hash function, instead of the parent public key, as shown in the diagram in <a href="#CKDprime">[CKDprime]</a>.</p></div>
<div class="imageblock" id="CKDprime">
<div class="content">
<img src="images/msbt_0413.png" alt="ChildHardPrivateDerivation" />
</div>
<div class="title">Figure 12. Hardened derivation of a child key; omits the parent public key</div>
</div>
<div class="paragraph"><p>Quando la funzione di derivazione delle chiavi private hardened è utilizzata, la chiave privata figlia e il chain code sono completamente diversi da quello che risulterebbe da una normale funzione di derivazione. Il "ramo" risultante di chiavi può essere usato per produrre chiavi pubbliche estese che non siano vulnerabili, perché il chain code contenuto in esse non può essere compromesso per rivelare alcuna chiave privata. La derivazione delle chiavi hardened è quindi utilizzata per creare uno "spazio" nell&#8217;albero precedente dove le chiavi pubbliche estese sono usate.</p></div>
<div class="paragraph"><p>In simple terms, if you want to use the convenience of an extended public key to derive branches of public keys, without exposing yourself to the risk of a leaked chain code, you should derive it from a hardened parent, rather than a normal parent. As a best practice, the level-1 children of the master keys are always derived through the hardened derivation, to prevent compromise of the master keys.</p></div>
</div>
<div class="sect4">
<h5 id="_index_numbers_for_normal_and_hardened_derivation">Index numbers for normal and hardened derivation</h5>
<div class="paragraph"><p>The index number used in the derivation function is a 32-bit integer. To easily distinguish between keys derived through the normal derivation function versus keys derived through hardened derivation, this index number is split into two ranges. Index numbers between 0 and 2<sup>31</sup>–1 (0x0 to 0x7FFFFFFF) are used <em>only</em> for normal derivation. Index numbers between 2<sup>31</sup> and 2<sup>32</sup>–1 (0x80000000 to 0xFFFFFFFF) are used <em>only</em> for hardened derivation. Therefore, if the index number is less than 2<sup>31</sup>, that means the child is normal, whereas if the index number is equal or above 2<sup>31</sup>, the child is hardened.</p></div>
<div class="paragraph"><p>To make the index number easier to read and display, the index number for hardened children is displayed starting from zero, but with a prime symbol. The first normal child key is therefore displayed as 0, whereas the first hardened child (index 0x80000000) is displayed as <markup>0'</markup>. In sequence then, the second hardened key would have index 0x80000001 and would be displayed as 1', and so on. When you see an HD wallet index i', that means 2<sup>31</sup>+i.</p></div>
</div>
<div class="sect4">
<h5 id="_hd_wallet_key_identifier_path">HD wallet key identifier (path)</h5>
<div class="paragraph"><p>Keys in an HD wallet are identified using a "path" naming convention, with each level of the tree separated by a slash (/) character (see <a href="#table_4-8">[table_4-8]</a>). Private keys derived from the master private key start with "m". Public keys derived from the master public key start with "M". Therefore, the first child private key of the master private key is m/0. The first child public key is M/0. The second grandchild of the first child is m/0/1, and so on.</p></div>
<div class="paragraph"><p>La "discendenza" di una chiave si può leggere da destra verso sinistra, fino a che non si raggiunge la master key dalla quale è stata derivata. Per esempio, l&#8217;identificatore m/x/y/z descrive la chiave che è la z-esima figlia della chiave m/x/y, la quale è la y-esima figlia della chiave m/x, che è la x-esima figlia di m.</p></div>
<div class="tableblock" id="table_4-8">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 8. HD wallet path examples</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">HD path </th>
<th align="left" valign="top"> Key described</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">m/0</p></td>
<td align="left" valign="top"><p class="table">The first (0) child private key from the master private key (m)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">m/0/0</p></td>
<td align="left" valign="top"><p class="table">The first grandchild private key of the first child (m/0)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">m/0'/0</p></td>
<td align="left" valign="top"><p class="table">The first normal grandchild of the first <em>hardened</em> child (m/0')</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">m/1/0</p></td>
<td align="left" valign="top"><p class="table">La prima chiave privata "nipote" derivata dal secondo "figlio" (m/1)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">M/23/17/0/0</p></td>
<td align="left" valign="top"><p class="table">The first great-great-grandchild public key of the first great-grandchild of the 18th grandchild of the 24th child</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_navigando_la_struttura_ad_albero_degli_hd_wallet">Navigando la struttura ad albero degli HD wallet</h5>
<div class="paragraph"><p>The HD wallet tree structure offers tremendous flexibility. Each parent extended key can have 4 billion children: 2 billion normal children and 2 billion hardened children. Each of those children can have another 4 billion children, and so on. The tree can be as deep as you want, with an infinite number of generations. With all that flexibility, however, it becomes quite difficult to navigate this infinite tree. It is especially difficult to transfer HD wallets between implementations, because the possibilities for internal organization into branches and subbranches are endless.</p></div>
<div class="paragraph"><p>Two Bitcoin Improvement Proposals (BIPs) offer a solution to this complexity, by creating some proposed standards for the structure of HD wallet trees. BIP0043 proposes the use of the first hardened child index as a special identifier that signifies the "purpose" of the tree structure. Based on BIP0043, an HD wallet should use only one level-1 branch of the tree, with the index number identifying the structure and namespace of the rest of the tree by defining its purpose. For example, an HD wallet using only branch m/i'/ is intended to signify a specific purpose and that purpose is identified by index number "i".</p></div>
<div class="paragraph"><p>Extending that specification, BIP0044 proposes a multiaccount structure as "purpose" number <tt>44'</tt> under BIP0043. All HD wallets following the BIP0044 structure are identified by the fact that they only used one branch of the tree: m/44'/.</p></div>
<div class="paragraph"><p>BIP0044 specifica la struttura consistente di cinque livelli ad albero predefiniti:</p></div>
<div class="paragraph"><p><tt>m / purpose' / coin_type' / account' / change / address_index</tt></p></div>
<div class="paragraph"><p>The first-level "purpose" is always set to <tt>44'</tt>. The second-level "coin_type" specifies the type of cryptocurrency coin, allowing for multicurrency HD wallets where each currency has its own subtree under the second level. There are three currencies defined for now: Bitcoin is m/44'/0', Bitcoin Testnet is <markup>m/44'/1'</markup>; and Litecoin is <markup>m/44'/2'</markup>.</p></div>
<div class="paragraph"><p>The third level of the tree is "account," which allows users to subdivide their wallets into separate logical subaccounts, for accounting or organizational purposes. For example, an HD wallet might contain two bitcoin "accounts": <markup>m/44'/0'/0'</markup> and <markup>m/44'/0'/1'</markup>. Each account is the root of its own subtree.</p></div>
<div class="paragraph"><p>On the fourth level, "change," an HD wallet has two subtrees, one for creating receiving addresses and one for creating change addresses. Note that whereas the previous levels used hardened derivation, this level uses normal derivation. This is to allow this level of the tree to export extended public keys for use in a nonsecured environment. Usable addresses are derived by the HD wallet as children of the fourth level, making the fifth level of the tree the "address_index." For example, the third receiving address for bitcoin payments in the primary account would be M/44'/0'/0'/0/2. <a href="#table_4-9">[table_4-9]</a> shows a few more examples.</p></div>
<div class="tableblock" id="table_4-9">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 9. BIP0044 Esempi della struttura dei HD wallet</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">HD path </th>
<th align="left" valign="top"> Key described</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">M/44'/0'/0'/0/2</p></td>
<td align="left" valign="top"><p class="table">La terza chiave pubblica ricevente per l&#8217;account bitcoin primario</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">M/44'/0'/3'/1/14</p></td>
<td align="left" valign="top"><p class="table">La quindicesima chiave pubblica dell&#8217;indirizzo-del-resto per il quarto account bitcoin</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">m/44'/2'/0'/0/1</p></td>
<td align="left" valign="top"><p class="table">The second private key in the Litecoin main account, for signing transactions</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_esperimenti_con_gli_hd_wallet_utilizzando_bitcoin_explorer">Esperimenti con gli HD wallet utilizzando Bitcoin Explorer</h5>
<div class="paragraph"><p>Using the Bitcoin Explorer command-line tool introduced in <a href="#ch03_bitcoin_client">[ch03_bitcoin_client]</a>, you can experiment with generating and extending BIP0032 deterministic keys, as well as displaying them in different formats: </p></div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_chiavi_avanzate_e_indirizzi">Chiavi avanzate e Indirizzi</h3>
<div class="paragraph"><p>Nelle sezioni seguenti osserveremo le forme avanzate di chiavi e indirizzi quali, chiavi private criptate, indirizzi script e multifirma, vanity address e paper wallet.</p></div>
<div class="sect3">
<h4 id="_chiave_privata_criptata_bip0038">Chiave Privata Criptata (BIP0038)</h4>
<div class="paragraph"><p>Private keys must remain secret. The need for <em>confidentiality</em> of the private keys is a truism that is quite difficult to achieve in practice, because it conflicts with the equally important security objective of <em>availability</em>. Keeping the private key private is much harder when you need to store backups of the private key to avoid losing it. A private key stored in a wallet that is encrypted by a password might be secure, but that wallet needs to be backed up. At times, users need to move keys from one wallet to another—to upgrade or replace the wallet software, for example. Private key backups might also be stored on paper (see <a href="#paper_wallets">[paper_wallets]</a>) or on external storage media, such as a USB flash drive. But what if the backup itself is stolen or lost? These conflicting security goals led to the introduction of a portable and convenient standard for encrypting private keys in a way that can be understood by many different wallets and bitcoin clients, standardized by Bitcoin Improvement Proposal 38  or BIP0038 (see <a href="#bip0038">[bip0038]</a>).</p></div>
<div class="paragraph"><p>BIP0038 proposes a common standard for encrypting private keys with a passphrase and encoding them with Base58Check so that they can be stored securely on backup media, transported securely between wallets, or kept in any other conditions where the key might be exposed. The standard for encryption uses the Advanced Encryption Standard (AES), a standard established by the National Institute of Standards and Technology (NIST) and used broadly in data encryption implementations for commercial and military applications.</p></div>
<div class="paragraph"><p>A BIP0038 encryption scheme takes as input a bitcoin private key, usually encoded in the Wallet Import Format (WIF), as a Base58Check string with a prefix of "5".  Additionally, the BIP0038 encryption scheme takes a passphrase—a long password—usually composed of several words or a complex string of alphanumeric characters. The result of the BIP0038 encryption scheme is a Base58Check-encoded encrypted private key that begins with the prefix <tt>6P</tt>. If you see a key that starts with <tt>6P</tt>, that means it is encrypted and requires a passphrase in order to convert (decrypt) it back into a WIF-formatted private key (prefix <tt>5</tt>) that can be used in any wallet. Many wallet applications now recognize BIP0038-encrypted private keys and will prompt the user for a passphrase to decrypt and import the key. Third-party applications, such as the incredibly useful browser-based <a href="http://bitaddress.org">Bit Address</a> (Wallet Details tab), can be used to decrypt BIP0038 keys.</p></div>
<div class="paragraph"><p>The most common use case for BIP0038 encrypted keys is for paper wallets that can be used to back up private keys on a piece of paper. As long as the user selects a strong passphrase, a paper wallet with BIP0038 encrypted private keys is incredibly secure and a great way to create offline bitcoin storage (also known as "cold storage").</p></div>
<div class="paragraph"><p>Prova le chiavi criptate nella <a href="#table_4-10">[table_4-10]</a> usando bitaddress.org per vedere come ottenere la chiave decriptata inserendo la passphrase.</p></div>
<div class="tableblock" id="table_4-10">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 10. Esempio di chiave privata codificata BIP0038</caption>
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Private Key (WIF)</strong></p></td>
<td align="left" valign="top"><p class="table">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Passphrase</strong></p></td>
<td align="left" valign="top"><p class="table">MyTestPassphrase</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Chiave Criptata (BIP0038)</strong></p></td>
<td align="left" valign="top"><p class="table">6PRTHL6mWa48xSopbU1cKrVjpKbBZxcLRRCdctLJ3z5yxE87MobKoXdTsJ</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="p2sh_addresses">Pay-to-Script Hash (P2SH) e Indirizzi Multi-Sig</h4>
<div class="paragraph"><p>As we know, traditional bitcoin addresses begin with the number “1” and are derived from the public key, which is derived from the private key.  Although anyone can send bitcoin to a “1” address, that bitcoin can only be spent by presenting the corresponding private key signature and public key hash.</p></div>
<div class="paragraph"><p>Bitcoin addresses that begin with the number “3” are pay-to-script hash (P2SH) addresses, sometimes erroneously called multi-signature or multi-sig addresses. They designate the beneficiary of a bitcoin transaction as the hash of a script, instead of the owner of a public key. The feature was introduced in January 2012 with Bitcoin Improvement Proposal 16, or BIP0016 (see <a href="#bip0016">[bip0016]</a>), and is being widely adopted because it provides the opportunity to add functionality to the address itself. Unlike transactions that "send" funds to traditional “1” bitcoin addresses, also known as pay-to-public-key-hash (P2PKH), funds sent to “3” addresses require something more than the presentation of one public key hash and one private key signature as proof of ownership. The requirements are designated at the time the address is created, within the script, and all inputs to this address will be encumbered with the same requirements.</p></div>
<div class="paragraph"><p>A pay-to-script hash address is created from a transaction script, which defines who can spend a transaction output (for more detail, see <a href="#p2sh">[p2sh]</a>). Encoding a pay-to-script hash address involves using the same double-hash function as used during creation of a bitcoin address, only applied on the script instead of the public key:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>script hash = RIPEMD160(SHA256(script))</tt></pre>
</div></div>
<div class="paragraph"><p>The resulting "script hash" is encoded with Base58Check with a version prefix of 5, which results in an encoded address starting with a <tt>3</tt>. An example of a P2SH address is <tt>3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM</tt>, which can be derived using the Bitcoin Explorer commands <tt>script-encode</tt>, <tt>sha256</tt>, <tt>ripemd160</tt>, and <tt>base58check-encode</tt> (see <a href="#libbitcoin">[libbitcoin]</a>) as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ echo dup hash160 [ 89abcdefabbaabbaabbaabbaabbaabbaabbaabba ] equalverify checksig &gt; script
$ bx script-encode &lt; script | bx sha256 | bx ripemd160 | bx base58check-encode --version 5
3F6i6kwkevjR7AsAd4te2YB2zZyASEm1HM</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>P2SH is not necessarily the same as a multi-signature standard transaction. A P2SH address <em>most often</em> represents a multi-signature script, but it might also represent a script encoding other types of transactions.</p></div>
</td>
</tr></table>
</div>
<div class="sect4">
<h5 id="_indirizzi_multi_firma_e_p2sh">Indirizzi Multi-firma e P2SH</h5>
<div class="paragraph"><p>Currently, the most common implementation of the P2SH function is the multi-signature address script. As the name implies, the underlying script requires more than one signature to prove ownership and therefore spend funds. The bitcoin multi-signature feature is designed to require M signatures (also known as the “threshold”) from a total of N keys, known as an M-of-N multi-sig, where M is equal to or less than N. For example, Bob the coffee shop owner from <a href="#ch01_intro_what_is_bitcoin">[ch01_intro_what_is_bitcoin]</a> could use a multi-signature address requiring 1-of-2 signatures from a key belonging to him and a key belonging to his spouse, ensuring either of them could sign to spend a transaction output locked to this address. This would be similar to a “joint account” as implemented in traditional banking where either spouse can spend with a single signature. Or Gopesh, the web designer paid by Bob to create a website, might have a 2-of-3 multi-signature address for his business that ensures that no funds can be spent unless at least two of the business partners sign a transaction.</p></div>
<div class="paragraph"><p>Esploreremo come creare transazioni che spendono fondi da indirizzi P2SH (e multi-signature) in <a href="#transactions">[transactions]</a>.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_vanity_address">Vanity Address</h4>
<div class="paragraph"><p>Vanity addresses are valid bitcoin addresses that contain human-readable messages. For example, <tt>1LoveBPzzD72PUXLzCkYAtGFYmK5vYNR33</tt> is a valid address that contains the letters forming the word "Love" as the first four Base-58 letters. Vanity addresses require generating and testing billions of candidate private keys, until one derives a bitcoin address with the desired pattern. Although there are some optimizations in the vanity generation algorithm, the process essentially involves picking a private key at random, deriving the public key, deriving the bitcoin address, and checking to see if it matches the desired vanity pattern, repeating billions of times until a match is found.</p></div>
<div class="paragraph"><p>Once a vanity address matching the desired pattern is found, the private key from which it was derived can be used by the owner to spend bitcoins in exactly the same way as any other address. Vanity addresses are no less or more secure than any other address. They depend on the same Elliptic Curve Cryptography (ECC) and Secure Hash Algorithm (SHA) as any other address. You can no more easily find the private key of an address starting with a vanity pattern than you can any other address.</p></div>
<div class="paragraph"><p>Nel <a href="#ch01_intro_what_is_bitcoin">[ch01_intro_what_is_bitcoin]</a>, abbiamo introdotto Eugenia, direttrice di un&#8217;associazione no-profit che opera nelle Filippine. Mettiamo che Eugenia sta organizzando una raccolta fondi in bitcoin e voglia usare un bitcoin vanity address per pubblicizzare la raccolta fondi. Eugenia creerà un vanity address che inizia con "1Kids" per promuovere la raccolta fondii della no-profit che si occupa di bambini bisognosi. Vediamo come questo vanity address sarà generato e come la no-profit di Eugenia si dovrà comportare riguardo alla sicurezza.</p></div>
<div class="sect4">
<h5 id="_generare_vanity_address">Generare vanity address</h5>
<div class="paragraph"><p>It&#8217;s important to realize that a bitcoin address is simply a number represented by symbols in the Base58 alphabet. The search for a pattern like "1Kids" can be seen as searching for an address in the range from <tt>1Kids11111111111111111111111111111</tt> to <tt>1Kidszzzzzzzzzzzzzzzzzzzzzzzzzzzzz</tt>. There are approximately 58<sup>29</sup> (approximately 1.4 * 10<sup>51</sup>) addresses in that range, all starting with "1Kids". <a href="#table_4-11">[table_4-11]</a> shows the range of addresses that have the prefix 1Kids.</p></div>
<div class="tableblock" id="table_4-11">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 11. La gamma di vanity address che iniziano con "1Kids"</caption>
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Da</strong></p></td>
<td align="left" valign="top"><p class="table"><tt>1Kids11111111111111111111111111111</tt></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"><tt>1Kids11111111111111111111111111112</tt></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"><tt>1Kids11111111111111111111111111113</tt></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"><tt>&#8230;</tt></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>A</strong></p></td>
<td align="left" valign="top"><p class="table"><tt>1Kidszzzzzzzzzzzzzzzzzzzzzzzzzzzzz</tt></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Let&#8217;s look at the pattern "1Kids" as a number and see how frequently we might find this pattern in a bitcoin address (see <a href="#table_4-12">[table_4-12]</a>). An average desktop computer PC, without any specialized hardware, can search approximately 100,000 keys per second.</p></div>
<div class="tableblock" id="table_4-12">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 12. La frequenza di un vanity pattern (1KidsCharity) e il tempo-di-ricerca su un PC fisso</caption>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
<thead>
<tr>
<th align="left" valign="top"> Lunghezza </th>
<th align="left" valign="top"> Pattern </th>
<th align="left" valign="top"> Frequenza </th>
<th align="left" valign="top"> Tempo medio di ricerca</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">1K</p></td>
<td align="left" valign="top"><p class="table">1 su 58 chiavi</p></td>
<td align="left" valign="top"><p class="table">&lt; 1 millisecondi</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">2</p></td>
<td align="left" valign="top"><p class="table">1Ki</p></td>
<td align="left" valign="top"><p class="table">1 su 3,364</p></td>
<td align="left" valign="top"><p class="table">50 millisecondi</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3</p></td>
<td align="left" valign="top"><p class="table">1Kid</p></td>
<td align="left" valign="top"><p class="table">1 su 195,000</p></td>
<td align="left" valign="top"><p class="table">&lt; 2 secondi</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">4</p></td>
<td align="left" valign="top"><p class="table">1Kids</p></td>
<td align="left" valign="top"><p class="table">1 su 11 million</p></td>
<td align="left" valign="top"><p class="table">1 minuto</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">1KidsC</p></td>
<td align="left" valign="top"><p class="table">1 su 656 milioni</p></td>
<td align="left" valign="top"><p class="table">1 ora</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6</p></td>
<td align="left" valign="top"><p class="table">1KidsCh</p></td>
<td align="left" valign="top"><p class="table">1 su 38 miliardi</p></td>
<td align="left" valign="top"><p class="table">2 giorni</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">7</p></td>
<td align="left" valign="top"><p class="table">1KidsCha</p></td>
<td align="left" valign="top"><p class="table">1 su 2.2 mila miliardi</p></td>
<td align="left" valign="top"><p class="table">3–4 mesi</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">8</p></td>
<td align="left" valign="top"><p class="table">1KidsChar</p></td>
<td align="left" valign="top"><p class="table">1 su 128 mila miliardi</p></td>
<td align="left" valign="top"><p class="table">13–18 anni</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9</p></td>
<td align="left" valign="top"><p class="table">1KidsChari</p></td>
<td align="left" valign="top"><p class="table">1 su 7 milioni di miliardi</p></td>
<td align="left" valign="top"><p class="table">800 anni</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">10</p></td>
<td align="left" valign="top"><p class="table">1KidsCharit</p></td>
<td align="left" valign="top"><p class="table">1 su 400 milioni di miliardi</p></td>
<td align="left" valign="top"><p class="table">46,000 anni</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">11</p></td>
<td align="left" valign="top"><p class="table">1KidsCharity</p></td>
<td align="left" valign="top"><p class="table">1 su 23 mila milioni di miliardi</p></td>
<td align="left" valign="top"><p class="table">2.5 milioni di anni</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>As you can see, Eugenia won&#8217;t be creating the vanity address "1KidsCharity" any time soon, even if she had access to several thousand computers. Each additional character increases the difficulty by a factor of 58. Patterns with more than seven characters are usually found by specialized hardware, such as custom-built desktops with multiple graphical processing units (GPUs). These are often repurposed bitcoin mining "rigs" that are no longer profitable for bitcoin mining but can be used to find vanity addresses. Vanity searches on GPU systems are many orders of magnitude faster than on a general-purpose CPU.</p></div>
<div class="paragraph"><p>Another way to find a vanity address is to outsource the work to a pool of vanity miners, such as the pool at <a href="http://vanitypool.appspot.com">Vanity Pool</a>. A pool is a service that allows those with GPU hardware to earn bitcoin searching for vanity addresses for others. For a small payment (0.01 bitcoin or approximately $5 at the time of this writing), Eugenia can outsource the search for a seven-character pattern vanity address and get results in a few hours instead of having to run a CPU search for months.</p></div>
<div class="paragraph"><p>Generating a vanity address is a brute-force exercise: try a random key, check the resulting address to see if it matches the desired pattern, repeat until successful. <a href="#vanity_miner_code">[vanity_miner_code]</a> shows an example of a "vanity miner," a program designed to find vanity addresses, written in C++. The example uses the libbitcoin library, which we introduced in <a href="#alt_libraries">[alt_libraries]</a>.</p></div>
<div class="exampleblock" id="vanity_miner_code">
<div class="title">Example 8. Miner di vanity address</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>The example above uses <tt>std::random_device</tt>. Depending on the implementation it may reflect a cryptographically secure random number generator (CSRNG) provided by the underlying operating system. In the case of UNIX-like operating system such as Linux, it draws from <tt>/dev/urandom</tt>. While the random number generator used here is for demonstration purposes, it is <em>not</em> appropriate for generating production-quality bitcoin keys as it is not implemented with sufficient security.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>The example code must be compiled using a C<tt> compiler and linked against the libbitcoin library (which must be first installed on that system). To run the example, run the </tt>vanity-miner++ executable with no parameters (see <a href="#vanity_miner_run">[vanity_miner_run]</a>) and it will attempt to find a vanity address starting with "1kid".</p></div>
<div class="exampleblock" id="vanity_miner_run">
<div class="title">Example 9. Compilare e eseguire l&#8217;esempio di vanity-miner</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="paragraph"><p>Il codice d&#8217;esempio impiegherà pochi secondi per trovare una corrispondenza per il pattern "kid", come possiamo vedere quando usiamo il comando Unix <tt>time</tt> per misurare il tempo d&#8217;esecuzione. Puoi cambiare il <tt>pattern di ricerca</tt> nei codice sorgente e vedere quanto più tempo impiegano dei pattern di quattro o cinque caratteri!</p></div>
</div>
<div class="sect4">
<h5 id="_sicurezza_dei_vanity_address">Sicurezza dei vanity address</h5>
<div class="paragraph"><p>Vanity addresses can be used to enhance <em>and</em> to defeat security measures; they are truly a double-edged sword. Used to improve security, a distinctive address makes it harder for adversaries to substitute their own address and fool your customers into paying them instead of you. Unfortunately, vanity addresses also make it possible for anyone to create an address that <em>resembles</em> any random address, or even another vanity address, thereby fooling your customers.</p></div>
<div class="paragraph"><p>Eugenia potrebbe pubblicare un indirizzo generato casualmente (e.g., <tt>1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</tt>) a cui altri utenti possono inviare le loro donazioni. Oppure, potrebbe generare un vanity address che inizi con 1Kids, per renderlo più riconoscibile.</p></div>
<div class="paragraph"><p>In both cases, one of the risks of using a single fixed address (rather than a separate dynamic address per donor) is that a thief might be able to infiltrate your website and replace it with his own address, thereby diverting donations to himself. If you have advertised your donation address in a number of different places, your users may visually inspect the address before making a payment to ensure it is the same one they saw on your website, on your email, and on your flyer. In the case of a random address like <tt>1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</tt>, the average user will perhaps inspect the first few characters "1J7mdg" and be satisfied that the address matches. Using a vanity address generator, someone with the intent to steal by substituting a similar-looking address can quickly generate addresses that match the first few characters, as shown in <a href="#table_4-13">[table_4-13]</a>.</p></div>
<div class="tableblock" id="table_4-13">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 13. Generando un vanity address che sia simile a un&#8217;indirizzo casuale</caption>
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Original Random Address</strong></p></td>
<td align="left" valign="top"><p class="table">1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Vanity (4 character match)</strong></p></td>
<td align="left" valign="top"><p class="table">1J7md1QqU4LpctBetHS2ZoyLV5d6dShhEy</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Vanity (5 character match)</strong></p></td>
<td align="left" valign="top"><p class="table">1J7mdgYqyNd4ya3UEcq31Q7sqRMXw2XZ6n</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>Vanity (6 character match)</strong></p></td>
<td align="left" valign="top"><p class="table">1J7mdg5WxGENmwyJP9xuGhG5KRzu99BBCX</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>So does a vanity address increase security? If Eugenia generates the vanity address <tt>1Kids33q44erFfpeXrmDSz7zEqG2FesZEN</tt>, users are likely to look at the vanity pattern word <em>and a few characters beyond</em>, for example noticing the "1Kids33" part of the address. That would force an attacker to generate a vanity address matching at least six characters (two more), expending an effort that is 3,364 times (58 &#x00D7; 58) higher than the effort Eugenia expended for her four-character vanity. Essentially, the effort Eugenia expends (or pays a vanity pool for) "pushes" the attacker into having to produce a longer pattern vanity. If Eugenia pays a pool to generate an 8-character vanity address, the attacker would be pushed into the realm of 10 characters, which is infeasible on a personal computer and expensive even with a custom vanity-mining rig or vanity pool. What is affordable for Eugenia becomes unaffordable for the attacker, especially if the potential reward of fraud is not high enough to cover the cost of the vanity address generation.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="paper_wallets">I Paper Wallet</h4>
<div class="paragraph"><p>Paper wallets are bitcoin private keys printed on paper. Often the paper wallet also includes the corresponding bitcoin address for convenience, but this is not necessary because it can be derived from the private key. Paper wallets are a very effective way to create backups or offline bitcoin storage, also known as "cold storage." As a backup mechanism, a paper wallet can provide security against the loss of key due to a computer mishap such as a hard drive failure, theft, or accidental deletion. As a "cold storage" mechanism, if the paper wallet keys are generated offline and never stored on a computer system, they are much more secure against hackers, key-loggers, and other online computer threats.</p></div>
<div class="paragraph"><p>I paper wallet sono disponibili in molte forme, dimensioni e design, ma essenzialmente sono solo una chiave e un indirizzo stampati su carta. <a href="#table_4-14">[table_4-14]</a> mostra la forma più semplice di un paper wallet.</p></div>
<div class="tableblock" id="table_4-14">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 14. La forma più semplice di paper wallet—un foglio stampato con l&#8217;indirizzo bitcoin e la chiave privata.</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Public Address</th>
<th align="left" valign="top">Private Key (WIF)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">1424C2F4bC9JidNjjTUZCbUxv6Sa1Mt62x</p></td>
<td align="left" valign="top"><p class="table">5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Paper wallets can be generated easily using a tool such as the client-side JavaScript generator at <em>bitaddress.org</em>. This page contains all the code necessary to generate keys and paper wallets, even while completely disconnected from the Internet. To use it, save the HTML page on your local drive or on an external USB flash drive. Disconnect from the Internet and open the file in a browser. Even better, boot your computer using a pristine operating system, such as a CD-ROM bootable Linux OS. Any keys generated with this tool while offline can be printed on a local printer over a USB cable (not wirelessly), thereby creating paper wallets whose keys exist only on the paper and have never been stored on any online system. Put these paper wallets in a fireproof safe and "send" bitcoin to their bitcoin address, to implement a simple yet highly effective "cold storage" solution. <a href="#paper_wallet_simple">[paper_wallet_simple]</a> shows a paper wallet generated from the bitaddress.org site.</p></div>
<div class="imageblock" id="paper_wallet_simple">
<div class="content">
<img src="images/msbt_0414.png" alt="images/msbt_0414.png" />
</div>
<div class="title">Figure 13. Un esempio di un paper wallet semplice da bitaddress.org</div>
</div>
<div class="paragraph"><p>The disadvantage of the simple paper wallet system is that the printed keys are vulnerable to theft. A thief who is able to gain access to the paper can either steal it or photograph the keys and take control of the bitcoins locked with those keys. A more sophisticated paper wallet storage system uses BIP0038 encrypted private keys. The keys printed on the paper wallet are protected by a passphrase that the owner has memorized. Without the passphrase, the encrypted keys are useless. Yet, they still are superior to a passphrase-protected wallet because the keys have never been online and must be physically retrieved from a safe or other physically secured storage. <a href="#paper_wallet_encrypted">[paper_wallet_encrypted]</a> shows a paper wallet with an encrypted private key (BIP0038) created on the bitaddress.org site.</p></div>
<div class="imageblock" id="paper_wallet_encrypted">
<div class="content">
<img src="images/msbt_0415.png" alt="images/msbt_0415.png" />
</div>
<div class="title">Figure 14. Un esempio di un paper wallet protetto da password dal sito  bitaddress.org . La passphrase è "test."</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>Although you can deposit funds into a paper wallet several times, you should withdraw all funds only once, spending everything. This is because in the process of unlocking and spending funds some wallets might generate a change address if you spend less than the whole amount. Additionally, if the computer you use to sign the transaction is compromised, you risk exposing the private key. By spending the entire balance of a paper wallet only once, you reduce the risk of key compromise. If you need only a small amount, send any remaining funds to a new paper wallet in the same transaction.</p></div>
</div></div>
<div class="paragraph"><p>Esistono paper wallet esistono in molte dimensioni e forme, e con diverse funzionalità. Alcuni sono fatti per essere dati come regalo e hanno temi particolari come per esempoo temi di Natale e Capodanno. Altri sono stati progettati per essere conservati in una cassetta di sicurezza o cassaforte con la chiave privata nascosta in qualche maniera, sia con un etichetta opaca grattabile, o piegata e sigillata con un foglio di alluminio adesivo a prova di apertura inattesa. TODO</p></div>
<div class="imageblock" id="paper_wallet_bpw">
<div class="content">
<img src="images/msbt_0416.png" alt="images/msbt_0416.png" />
</div>
<div class="title">Figure 15. Un esempio di un paper wallet da bitcoinpaperwallet.com con la private key stampata su una parte pieghevole.</div>
</div>
<div class="imageblock" id="paper_wallet_bpw_folded">
<div class="content">
<img src="images/msbt_0417.png" alt="images/msbt_0417.png" />
</div>
<div class="title">Figure 16. Il paper wallet di bitcoinpaperwallet.com con la chiave privata nascosta.</div>
</div>
<div class="paragraph"><p>Other designs feature additional copies of the key and address, in the form of detachable stubs similar to ticket stubs, allowing you to store multiple copies to protect against fire, flood, or other natural disasters.</p></div>
<div class="imageblock" id="paper_wallet_spw">
<div class="content">
<img src="images/msbt_0418.png" alt="images/msbt_0418.png" />
</div>
<div class="title">Figure 17. Un esempio di un paper wallet con copie aggiuntive di un backup "campione".</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2015-07-15 16:56:59 UTC
</div>
</div>
</body>
</html>
