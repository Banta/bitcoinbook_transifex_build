<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.7" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="ch02_bitcoin_overview">比特币原理</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_交易_区块_挖矿和区块链">交易，区块，挖矿和区块链</h3>
<div class="paragraph"><p>比特币系统与传统银行和支付系统不一样，它是基于去中心化的信任，而不是中央可信机构。比特币的信任是由系统中不同参与者之间的交互而自然产生的一种属性。这一章里，我们通过在应用层面跟踪一条比特币系统里的交易，观察它如何变得“可信任”和被比特币的分布式共识机制所接受，从而最终被区块链（分布式交易总帐）记录。</p></div>
<div class="paragraph"><p>每一个例子都是基于比特币网络上真实发生的交易，它模拟用户（乔，爱丽丝和鲍伯）之间钱包资金流动的过程。在跟踪比特币网络和区块链中的交易时，我们使用a <em>blockchain explorer</em> site来可视化的观察每一个步骤。区块链浏览器是一个等同于比特币搜索引擎的网络程序，你可以在里面搜索地址，交易和区块，以及它们之间的关系和流向。</p></div>
<div class="paragraph"><p>流行的比特币浏览器有： </p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://blockchain.info">Blockchain info</a>
</p>
</li>
<li>
<p>
<a href="http://blockexplorer.com">Bitcoin Block Explorer</a>
</p>
</li>
<li>
<p>
<a href="http://insight.bitpay.com">insight</a>
</p>
</li>
<li>
<p>
<a href="http://blockr.io">blockr Block Reader</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>上面每个网站都支持搜索地址，交易哈希，区块号然后找到比特币网络和区块链上对应的数据。每一个例子，我们都会提供一个超链接只想相关的记录，你可以做进一步了解。</p></div>
<div class="sect3">
<h4 id="_比特币概览">比特币概览</h4>
<div class="paragraph"><p>在<a href="#bitcoin-overview">[bitcoin-overview]</a>里面展示的概览里面，我们可以看到比特币系统包括拥有包含钥匙的钱包的用户，传播到整个网络的交易，以及通过竞争计算的方式产生大家认同的区块链（可以把它看成权威的交易总帐）。在这一章里面，我们会在应用层面跟踪一条交易是怎么传输到网络上的，然后观察比特币系统每一部分之间的交互。后续的章节会详细介绍钱包，挖矿和商业系统背后的技术细节。</p></div>
<div class="imageblock" id="bitcoin-overview">
<div class="content">
<img src="images/msbt_0201.png" alt="Bitcoin Overview" />
</div>
<div class="title">Figure 1. 比特币概览</div>
</div>
</div>
<div class="sect3">
<h4 id="cup_of_coffee">购买一杯咖啡</h4>
<div class="paragraph"><p>上一章里面出现的爱丽丝，是一个刚刚获得比特币的新用户，她和她的朋友乔见面并且用现金来换取了比特币。乔发起的交易给爱丽丝的钱包存入了0.1个比特币。现在爱丽丝将发起她的第一次零售交易，在位于加州帕洛阿尔托市的鲍伯咖啡馆购买一杯咖啡。鲍伯咖啡馆刚刚在他的POS系统里面加了比特币支付的功能，用于接受比特币支付。咖啡馆的价格是使用本地货币（美元）来标注的，客人可以选择在柜台用美元或者比特币来支付。爱丽丝购买了一杯咖啡，鲍伯在柜台输入了这条交易。POS系统会使用当前市场价格将总价从美元转换成比特币，并且同时显示两种货币的价格，还会显示一个包含该交易_支付请求_的二维码（参考<a href="#payment-request-QR">[payment-request-QR]</a>）：</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>总计:
$1.50 美元
0.015 比特币</tt></pre>
</div></div>
<div class="imageblock" id="payment-request-QR">
<div class="content">
<img src="images/msbt_0202.png" alt="payment-request" />
</div>
<div class="title">Figure 2. 支付二维码 (提示: 试着扫一下！)</div>
</div>
<div class="listingblock" id="payment-request-URL">
<div class="title">支付请求二维码编码了下面超链接，具体见BIP0021：</div>
<div class="content">
<pre><tt>bitcoin:1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA?
amount=0.015&amp;
label=Bob%27s%20Cafe&amp;
message=Purchase%20at%20Bob%27s%20Cafe

超链接组成部分

一个比特币地址： "1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"
支付金额： "0.015"
接收地址的标签： "Bob's Cafe"
支付描述信息： "Purchase at Bob's Cafe"</tt></pre>
</div></div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>和一个仅仅包含目标比特币地址的二维码不同，一个支付请求包含二维码编码的超链接，它包含目标地址，支付金额和一个类似于“鲍伯咖啡馆”的简单描述信息。比特币钱包程序能够根据这些内容来预填支付需要的信息并且显示用户可读的支付描述。你可以通过比特币钱包程序扫描二维码来查看爱丽丝会看到的界面。</p></div>
</div></div>
<div class="paragraph"><p>鲍伯说："这个需要一块五，也就是50豪比特币"</p></div>
<div class="paragraph"><p>爱丽丝使用她的智能手机来扫描显示屏上的条形码，她的手机上显示她需要支付+0.0150 BTC+给+鲍伯咖啡馆+，她点击+发送+来授权这次支付。几秒钟之后（和信用卡授权所花时间差不多），鲍伯会在柜台看到这条记录，从而完成这次交易。</p></div>
<div class="paragraph"><p>在接下来的几个章节里面，我们将仔细观察这条交易，来研究下爱丽丝的钱包是怎么发起它的，它是如何在网络上传播的，如果被验证的，然后看看最终鲍伯如果能够在接下来的交易中使用收到的比特币。</p></div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>比特币网络可以处理分数值，例如从豪比特（千分之一个比特币）到一百万分之一比特币，又被称作一聪。在这本书里面，我们将用“比特币”来指代比特币货币的数量，这个数量可以是从最小单位一聪到最终全部采矿产出的所有（两千一百万）比特币。</p></div>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_比特币交易">比特币交易</h3>
<div class="paragraph"><p>简单的说，一条交易告诉网络拥有一定数量比特币的人已经授权将一部分比特币发送给另外一个比特币持有者。新的持有者接下来可以通过授权发起新的交易来使用这些比特币，如此类推，形成一个使用权的传递链接。</p></div>
<div class="paragraph"><p>所有的交易就像是一个双条目的记帐本。简单的来说，一个交易包含一个或者多个“输入”，这些是对于某一个比特币账户的扣款。交易的另一端会有一个或者多个“输出”，这些是对于某一个比特币账户的存款。输入和输出（扣款和存款）并一定总和相等，实际上，输出加起来会比输入少一点点，这个差别就是所谓的“交易费用”，将这条交易加入总账的矿工会收取这点费用。在图<a href="#transaction-double-entry">[transaction-double-entry]</a>中，比特币交易被显示为记帐本里面的条目。</p></div>
<div class="paragraph"><p>交易包含对于所有被转移的比特币数量（输入）的所有权的证明，这是通过拥有者的数字签名来实现的，每个人都可以独立的来验证。在比特币术语里，“支付”是对从之前交易转移资金到一个通过比特币地址识别的新的拥有者这样一个交易进行的签名。</p></div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>交易_将资金从_交易的输入端_转移到_交易的输出端_。一个输入表明比特币金额的来源，通常是前一个交易的输出，一个交易输出通过关联一个密匙，将这个金额分配给新的拥有者。目标密匙也叫做_债权_，它使得未来资金必须要经过签名才能够使用。一个交易的输出可以被用作下一个新的交易的输入，这样当比特币从一个地址不断转移到另外一个地址的时候就形成了一个所有权的链条。（见 <a href="#blockchain-mnemonic">[blockchain-mnemonic]</a>）。</p></div>
</div></div>
<div class="imageblock" id="transaction-double-entry">
<div class="content">
<img src="images/msbt_0203.png" alt="Transaction Double-Entry" />
</div>
<div class="title">Figure 3. 双条目记帐本的交易</div>
</div>
<div class="imageblock" id="blockchain-mnemonic">
<div class="content">
<img src="images/msbt_0204.png" alt="Transaction chain" />
</div>
<div class="title">Figure 4. 交易链，没有交易的输出就是下一个交易的输入。</div>
</div>
<div class="paragraph"><p>爱丽丝给鲍伯咖啡馆的付款使用前一个交易作为输入，在上一章中爱丽丝从她的朋友乔那里用现金交换了比特币。这个交易有好几个比特币被爱丽丝的密匙锁定（定权）。她与咖啡馆的新交易使用前一个交易作为输入，然后产生新的输出来支付那杯咖啡和接收找零。这个交易就形成了一个链条，最新交易的输入对应于前一个交易的输出。爱丽丝的密匙提供的签名可以解锁前一个交易的输出，这样就能向比特币网络证明她拥有这些资金。她将付款绑定在鲍伯的地址上，这样就使得限制了输出的使用，鲍伯必须要提供一个签名之后才能够使用这些比特币。这就代表了在爱丽丝和鲍伯之间资金的流动，这个从乔到爱丽丝到鲍伯的交易链条，在这里<a href="#blockchain-mnemonic">[blockchain-mnemonic]</a>进行了展示。</p></div>
<div class="sect3">
<h4 id="_常见交易表单">常见交易表单</h4>
<div class="paragraph"><p>交易的最常见形式就是从一个地址到另外一个地址，通常会包含一定的“找零”返还给之前的拥有者。这种形式的交易拥有一个输入和两个输出，请参考<a href="#transaction-common">[transaction-common]</a>。</p></div>
<div class="imageblock" id="transaction-common">
<div class="content">
<img src="images/msbt_0205.png" alt="常见交易" />
</div>
<div class="title">Figure 5. 最常见的交易</div>
</div>
<div class="paragraph"><p>另外一种常见的交易形式是一个集合了多个输入到一个单独的输出（参见<a href="#transaction-aggregating">[transaction-aggregating]</a>）。这个对应真实世界里面用一把硬币和纸币换取一个较大金额的钞票。像这样的交易通常由钱包应用产生，用来清理很多支付找零产生的小额账户。</p></div>
<div class="imageblock" id="transaction-aggregating">
<div class="content">
<img src="images/msbt_0206.png" alt="集合交易" />
</div>
<div class="title">Figure 6. 交易汇集资金</div>
</div>
<div class="paragraph"><p>最后，另外一种常常在比特币总账上面看到的交易是将一个输入分发到代表多个接收人的输出里面（参见<a href="#transaction-distributing">[transaction-distributing]</a>）。这个形式的交易通常被商业实体用来分发资金，例如给多个员工发放工资。</p></div>
<div class="imageblock" id="transaction-distributing">
<div class="content">
<img src="images/msbt_0207.png" alt="分布式交易" />
</div>
<div class="title">Figure 7. 交易 分布式资金</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_构成一个交易">构成一个交易</h3>
<div class="paragraph"><p>爱丽丝的钱包应用包含选择适当输入输出的所有逻辑，用以创建她设定的交易。爱丽丝只需要指定目标地址和金额，接下来发生在钱包应用里面的细节，爱丽丝并不需要知道。很重要的一点是，钱包应用可以在离线的时候构建交易。就想在家填写支票然后装在信封里面送到银行一样，这个交易不需要连接到比特币网络就可以被构建和签名。它只需要最终被发送到网络上执行即可。</p></div>
<div class="sect3">
<h4 id="_获得正确的输入">获得正确的输入</h4>
<div class="paragraph"><p>Alice&#8217;s wallet application will first have to find inputs that can pay for the amount she wants to send to Bob. Most wallet applications keep a small database of "unspent transaction outputs" that are locked (encumbered) with the wallet&#8217;s own keys. Therefore, Alice&#8217;s wallet would contain a copy of the transaction output from Joe&#8217;s transaction, which was created in exchange for cash (see <a href="#getting_first_bitcoin">[getting_first_bitcoin]</a>). A bitcoin wallet application that runs as a full-index client actually contains a copy of every unspent output from every transaction in the blockchain. This allows a wallet to construct transaction inputs as well as quickly verify incoming transactions as having correct inputs. However, because a full-index client takes up a lot of disk space, most user wallets run "lightweight" clients that track only the user&#8217;s own unspent outputs.</p></div>
<div class="paragraph"><p>If the wallet application does not maintain a copy of unspent transaction outputs, it can query the bitcoin network to retrieve this information, using a variety of APIs available by different providers or by asking a full-index node using the bitcoin JSON RPC API. <a href="#example_2-1">[example_2-1]</a> shows a RESTful API request, constructed as an HTTP GET command to a specific URL. This URL will return all the unspent transaction outputs for an address, giving any application the information it needs to construct transaction inputs for spending. We use the simple command-line HTTP client <em>cURL</em> to retrieve the response.</p></div>
<div class="exampleblock" id="example_2-1">
<div class="title">Example 1. Look up all the unspent outputs for Alice&#8217;s bitcoin address</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="exampleblock" id="example_2-2">
<div class="title">Example 2. 查询输出</div>
<div class="content">
<div class="listingblock">
<div class="content"></div></div>
</div></div>
<div class="paragraph"><p><a href="#example_2-2">[example_2-2]</a>中的结果显示的是一个没有花出去的输出（还没有被使用），爱丽丝的地址+1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK+对其有所有权。这个返回结果还包括交易的引用，这个交易里面包含没有花出去的钱（来自乔的付款），以及以聪为单位的金额，一千万聪，也就是0.1个比特币。根据这些信息，爱丽丝的钱包就可以构建交易来把钱转移到另一个新的地址。</p></div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>查看<a href="http://bit.ly/1tAeeGr">乔到爱丽丝的交易</a>.</p></div>
</div></div>
<div class="paragraph"><p>你可以看到，爱丽丝的钱包在没有用过的单个输出里面拥有足够的比特币来购买一杯咖啡。如果不是这样的话，爱丽丝的钱包应用就会寻找一些小额的没有花掉的输出，就像从钱包里面拿出一些硬币，直到足够一杯咖啡的钱。这两种情况下，在钱包应用产生交易输出（付款）的时候都有可能会产生找零，我们在下一节会看到具体的过程。</p></div>
</div>
<div class="sect3">
<h4 id="_创建输出">创建输出</h4>
<div class="paragraph"><p>交易是以一个脚本的形式创建的，这个脚本对资金所有权进行了的约束，只有满足脚本的要求才能获得这些资金。简单的说，爱丽丝的交易输出包含一个脚本，它表明这个输出只属于能够提供鲍伯的公开地址对应公钥签名的人。因为只有鲍伯钱包里面有这个地址对应的公钥，只有他的钱包可以提供这样一个签名来申明这样一个输出的所有权。这样爱丽丝就通过要求鲍伯的签名限制了输出的资金的所有权。</p></div>
<div class="paragraph"><p>这个交易包含第二个输出，因为爱丽丝的资金是以0.10比特币的输出这样一个形式存在的，比一杯咖啡0.015比特币多很多，所以爱丽丝需要0.085比特币的找零。爱丽丝的找零支付是通过_爱丽丝的钱包_在给鲍伯的相同支付交易里面创建的。根本上来说，爱丽丝的钱包将资金分成两个支付，一个给鲍伯，另外一个还给她自己。然后她就可以用这个找零的输出在接下来的交易中使用，也就是说可以以后再花这些零钱。</p></div>
<div class="paragraph"><p>Finally, for the transaction to be processed by the network in a timely fashion, Alice&#8217;s wallet application will add a small fee. This is not explicit in the transaction; it is implied by the difference between inputs and outputs. If instead of taking 0.085 in change, Alice creates only 0.0845 as the second output, there will be 0.0005 BTC (half a millibitcoin) left over. The input&#8217;s 0.10 BTC is not fully spent with the two outputs, because they will add up to less than 0.10. The resulting difference is the <em>transaction fee</em> that is collected by the miner as a fee for including the transaction in a block and putting it on the blockchain ledger.</p></div>
<div class="paragraph"><p>The resulting transaction can be seen using a blockchain explorer web application, as shown in <a href="#transaction-alice">[transaction-alice]</a>.</p></div>
<div class="imageblock" id="transaction-alice">
<div class="content">
<img src="images/msbt_0208.png" alt="Alice Coffee Transaction" />
</div>
<div class="title">Figure 8. Alice&#8217;s transaction to Bob&#8217;s Cafe</div>
</div>
<div class="exampleblock" id="transaction-alice-url">
<div class="content">
<div class="paragraph"><p>View the <a href="http://bit.ly/1u0FIGs">transaction from Alice to Bob&#8217;s Cafe</a>.</p></div>
</div></div>
</div>
<div class="sect3">
<h4 id="_adding_the_transaction_to_the_ledger">Adding the Transaction to the Ledger</h4>
<div class="paragraph"><p>The transaction created by Alice&#8217;s wallet application is 258 bytes long and contains everything necessary to confirm ownership of the funds and assign new owners. Now, the transaction must be transmitted to the bitcoin network where it will become part of the distributed ledger (the blockchain). In the next section we will see how a transaction becomes part of a new block and how the block is "mined." Finally, we will see how the new block, once added to the blockchain, is increasingly trusted by the network as more blocks are added.</p></div>
<div class="sect4">
<h5 id="_transmitting_the_transaction">Transmitting the transaction</h5>
<div class="paragraph"><p>Because the transaction contains all the information necessary to process, it does not matter how or where it is transmitted to the bitcoin network. The bitcoin network is a peer-to-peer network, with each bitcoin client participating by connecting to several other bitcoin clients. The purpose of the bitcoin network is to propagate transactions and blocks to all participants.</p></div>
</div>
<div class="sect4">
<h5 id="_how_it_propagates">How it propagates</h5>
<div class="paragraph"><p>Alice&#8217;s wallet application can send the new transaction to any of the other bitcoin clients it is connected to over any Internet connection: wired, WiFi, or mobile. Her bitcoin wallet does not have to be connected to Bob&#8217;s bitcoin wallet directly and she does not have to use the Internet connection offered by the cafe, though both those options are possible, too. Any bitcoin network node (other client) that receives a valid transaction it has not seen before will immediately forward it to other nodes to which it is connected. Thus, the transaction rapidly propagates out across the peer-to-peer network, reaching a large percentage of the nodes within a few seconds.</p></div>
</div>
<div class="sect4">
<h5 id="_bob_8217_s_view">Bob&#8217;s view</h5>
<div class="paragraph"><p>If Bob&#8217;s bitcoin wallet application is directly connected to Alice&#8217;s wallet application, Bob&#8217;s wallet application might be the first node to receive the transaction. However, even if Alice&#8217;s wallet sends the transaction through other nodes, it will reach Bob&#8217;s wallet within a few seconds. Bob&#8217;s wallet will immediately identify Alice&#8217;s transaction as an incoming payment because it contains outputs redeemable by Bob&#8217;s keys. Bob&#8217;s wallet application can also independently verify that the transaction is well formed, uses previously unspent inputs, and contains sufficient transaction fees to be included in the next block. At this point Bob can assume, with little risk, that the transaction will shortly be included in a block and confirmed.</p></div>
<div class="exampleblock">
<div class="content">
<div class="paragraph"><p>A common misconception about bitcoin transactions is that they must be "confirmed" by waiting 10 minutes for a new block, or up to 60 minutes for a full six confirmations. Although confirmations ensure the transaction has been accepted by the whole network, such a delay is unnecessary for small-value items such as a cup of coffee. A merchant may accept a valid small-value transaction with no confirmations, with no more risk than a credit card payment made without an ID or a signature, as merchants routinely accept today.</p></div>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bitcoin_mining">Bitcoin Mining</h3>
<div class="paragraph"><p>The transaction is now propagated on the bitcoin network. It does not become part of the shared ledger (the <em>blockchain</em>) until it is verified and included in a block by a process called <em>mining</em>. See <a href="#ch8">[ch8]</a> for a detailed explanation.</p></div>
<div class="paragraph"><p>The bitcoin system of trust is based on computation. Transactions are bundled into <em>blocks</em>, which require an enormous amount of computation to prove, but only a small amount of computation to verify as proven. The mining process serves two purposes in bitcoin:</p></div>
<div class="ulist"><ul>
<li>
<p>
Mining creates new bitcoins in each block, almost like a central bank printing new money. The amount of bitcoin created per block is fixed and diminishes with time.
</p>
</li>
<li>
<p>
Mining creates trust by ensuring that transactions are only confirmed if enough computational power was devoted to the block that contains them. More blocks mean more computation, which means more trust.
</p>
</li>
</ul></div>
<div class="paragraph"><p>A good way to describe mining is like a giant competitive game of sudoku that resets every time someone finds a solution and whose difficulty automatically adjusts so that it takes approximately 10 minutes to find a solution. Imagine a giant sudoku puzzle, several thousand rows and columns in size. If I show you a completed puzzle you can verify it quite quickly. However, if the puzzle has a few squares filled and the rest are empty, it takes a lot of work to solve! The difficulty of the sudoku can be adjusted by changing its size (more or fewer rows and columns), but it can still be verified quite easily even if it is very large. The "puzzle" used in bitcoin is based on a cryptographic hash and exhibits similar characteristics: it is asymmetrically hard to solve but easy to verify, and its difficulty can be adjusted.</p></div>
<div class="paragraph"><p>In <a href="#user-stories">[user-stories]</a>, we introduced Jing, a computer engineering student in Shanghai. Jing is participating in the bitcoin network as a miner. Every 10 minutes or so, Jing joins thousands of other miners in a global race to find a solution to a block of transactions. Finding such a solution, the so-called proof of work, requires quadrillions of hashing operations per second across the entire bitcoin network. The algorithm for proof of work involves repeatedly hashing the header of the block and a random number with the SHA256 cryptographic algorithm until a solution matching a predetermined pattern emerges. The first miner to find such a solution wins the round of competition and publishes that block into the blockchain.</p></div>
<div class="paragraph"><p>Jing started mining in 2010 using a very fast desktop computer to find a suitable proof of work for new blocks. As more miners started joining the bitcoin network, the difficulty of the problem increased rapidly. Soon, Jing and other miners upgraded to more specialized hardware, such as high-end dedicated graphical processing units (GPUs) cards such as those used in gaming desktops or consoles. At the time of this writing, the difficulty is so high that it is profitable only to mine with application-specific integrated circuits (ASIC), essentially hundreds of mining algorithms printed in hardware, running in parallel on a single silicon chip. Jing also joined a "mining pool," which much like a lottery pool allows several participants to share their efforts and the rewards. Jing now runs two USB-connected ASIC machines to mine for bitcoin 24 hours a day. He pays his electricity costs by selling the bitcoin he is able to generate from mining, creating some income from the profits. His computer runs a copy of bitcoind, the reference bitcoin client, as a backend to his specialized mining software.</p></div>
</div>
<div class="sect2">
<h3 id="_mining_transactions_in_blocks">Mining Transactions in Blocks</h3>
<div class="paragraph"><p>A transaction transmitted across the network is not verified until it becomes part of the global distributed ledger, the blockchain. Every 10 minutes on average, miners generate a new block that contains all the transactions since the last block. New transactions are constantly flowing into the network from user wallets and other applications. As these are seen by the bitcoin network nodes, they get added to a temporary pool of unverified transactions maintained by each node. As miners build a new block, they add unverified transactions from this pool to a new block and then attempt to solve a very hard problem (a.k.a., proof of work) to prove the validity of that new block. The process of mining is explained in detail in <a href="#mining">[mining]</a>.</p></div>
<div class="paragraph"><p>Transactions are added to the new block, prioritized by the highest-fee transactions first and a few other criteria. Each miner starts the process of mining a new block of transactions as soon as he receives the previous block from the network, knowing he has lost that previous round of competition. He immediately creates a new block, fills it with transactions and the fingerprint of the previous block, and starts calculating the proof of work for the new block. Each miner includes a special transaction in his block, one that pays his own bitcoin address a reward of newly created bitcoins (currently 25 BTC per block). If he finds a solution that makes that block valid, he "wins" this reward because his successful block is added to the global blockchain and the reward transaction he included becomes spendable. Jing, who participates in a mining pool, has set up his software to create new blocks that assign the reward to a pool address. From there, a share of the reward is distributed to Jing and other miners in proportion to the amount of work they contributed in the last round.</p></div>
<div class="paragraph"><p>Alice&#8217;s transaction was picked up by the network and included in the pool of unverified transactions. Because it had sufficient fees, it was included in a new block generated by Jing&#8217;s mining pool. Approximately five minutes after the transaction was first transmitted by Alice&#8217;s wallet, Jing&#8217;s ASIC miner found a solution for the block and published it as block #277316, containing 419 other transactions. Jing&#8217;s ASIC miner published the new block on the bitcoin network, where other miners validated it and started the race to generate the next block.</p></div>
<div class="paragraph"><p>You can see the block that includes <a href="https://blockchain.info/block-height/277316">Alice&#8217;s transaction</a>.</p></div>
<div class="paragraph"><p>A few minutes later, a new block, #277317, is mined by another miner. Because this new block is based on the previous block (#277316) that contained Alice&#8217;s transaction, it added even more computation on top of that block, thereby strengthening the trust in those transactions. The block containing Alice&#8217;s transaction is counted as one "confirmation" of that transaction. Each block mined on top of the one containing the transaction is an additional confirmation. As the blocks pile on top of each other, it becomes exponentially harder to reverse the transaction, thereby making it more and more trusted by the network.</p></div>
<div class="paragraph"><p>In the diagram in <a href="#block-alice1">[block-alice1]</a>  we can see block #277316, which contains Alice&#8217;s transaction. Below it are 277,316 blocks (including block #0), linked to each other in a chain of blocks (blockchain) all the way back to block #0, known as the <em>genesis block</em>. Over time, as the "height" in blocks increases, so does the computation difficulty for each block and the chain as a whole. The blocks mined after the one that contains Alice&#8217;s transaction act as further assurance, as they pile on more computation in a longer and longer chain. By convention, any block with more than six confirmations is considered irrevocable, because it would require an immense amount of computation to invalidate and recalculate six blocks. We will examine the process of mining and the way it builds trust in more detail in <a href="#ch8">[ch8]</a>.</p></div>
<div class="imageblock" id="block-alice1">
<div class="content">
<img src="images/msbt_0209.png" alt="Alice's transaction included in a block" />
</div>
<div class="title">Figure 9. Alice&#8217;s transaction included in block #277316</div>
</div>
</div>
<div class="sect2">
<h3 id="_spending_the_transaction">Spending the Transaction</h3>
<div class="paragraph"><p>Now that Alice&#8217;s transaction has been embedded in the blockchain as part of a block, it is part of the distributed ledger of bitcoin and visible to all bitcoin applications. Each bitcoin client can independently verify the transaction as valid and spendable. Full-index clients can track the source of the funds from the moment the bitcoins were first generated in a block, incrementally from transaction to transaction, until they reach Bob&#8217;s address. Lightweight clients can do what is called a simplified payment verification (see <a href="#spv_nodes">[spv_nodes]</a>) by confirming that the transaction is in the blockchain and has several blocks mined after it, thus providing assurance that the network accepts it as valid.</p></div>
<div class="paragraph"><p>Bob can now spend the output from this and other transactions, by creating his own transactions that reference these outputs as their inputs and assign them new ownership. For example, Bob can pay a contractor or supplier by transferring value from Alice&#8217;s coffee cup payment to these new owners. Most likely, Bob&#8217;s bitcoin software will aggregate many small payments into a larger payment, perhaps concentrating all the day&#8217;s bitcoin revenue into a single transaction. This would move the various payments into a single address, used as the store&#8217;s general "checking" account. For a diagram of an aggregating transaction, see <a href="#transaction-aggregating">[transaction-aggregating]</a>.</p></div>
<div class="paragraph"><p>As Bob spends the payments received from Alice and other customers, he extends the chain of transactions, which in turn are added to the global blockchain ledger for all to see and trust. Let&#8217;s assume that Bob pays his web designer Gopesh in Bangalore for a new website page. Now the chain of transactions will look like <a href="#block-alice2">[block-alice2]</a>.</p></div>
<div class="imageblock" id="block-alice2">
<div class="content">
<img src="images/msbt_0210.png" alt="爱丽丝的交易最为交易链的一部分" />
</div>
<div class="title">Figure 10. 爱丽丝的交易最为乔到Gopesh交易链的一部分</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2015-07-15 16:55:54 UTC
</div>
</div>
</body>
</html>
